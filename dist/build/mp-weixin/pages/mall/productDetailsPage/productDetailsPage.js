(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mall/productDetailsPage/productDetailsPage"],{"0c1d":function(t,e,s){"use strict";var r=s("ed1d"),n=s.n(r);n.a},"551b":function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement;t._self._c},n=[];s.d(e,"a",function(){return r}),s.d(e,"b",function(){return n})},9795:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(s("a34a")),n=a(s("66fd")),i=s("c440"),o=s("5177");function a(t){return t&&t.__esModule?t:{default:t}}function c(t,e,s,r,n,i,o){try{var a=t[i](o),c=a.value}catch(u){return void s(u)}a.done?e(c):Promise.resolve(c).then(r,n)}function u(t){return function(){var e=this,s=arguments;return new Promise(function(r,n){var i=t.apply(e,s);function o(t){c(i,r,n,o,a,"next",t)}function a(t){c(i,r,n,o,a,"throw",t)}o(void 0)})}}var l=function(){return s.e("components/i-past/i-past").then(s.bind(null,"ed17"))},h=function(){return s.e("components/i-show/i-show").then(s.bind(null,"d057"))},d=function(){return s.e("components/i-rule/i-rule").then(s.bind(null,"0d7b"))},f=function(){return s.e("components/i-popup/i-popup").then(s.bind(null,"fbff"))},p=!1,g=[],m=n.default.extend({components:{iPast:l,iShow:h,iRule:d,iPopup:f},data:function(){return{indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,circular:!0,indicatorActiveColor:"#fe7f00",disabled:!1,swiper:[],title:"服务",id:"",product:"",num:"9999",tabIndex:0,pastList:[],showList:[],ruleList:"",show:!1,label:["零风险","正品承诺","极速发货","公平公正"],tab:["往期成交","分享晒单","竞拍规则"],src:"/static/icon_experience.png",leading:"/static/icon/icon_leading.png",ActiveID:"",Price:"",msgID:"",seq:"",MyBills:"",UserID:"",tapbtn:"",BillStat:"",newprice:"",newbill:"",lastbills:[],times:"",seqTime:new Date("2019/7/18 10:29:35")}},onLoad:function(t){this.id=t.id,this.ActiveID=t.id,this.getProduct(),this.getPastTransactionsList(),this.getOrderDryingList(),this.websocket()},methods:{getProduct:function(){var t=this,e=this.id,s={ProductID:e};(0,i.request)(o.ProductGet,s).then(function(e){console.log(e),t.product=e.Product,t.swiper=e.Product.ProductPicList})},tabClick:function(t){this.tabIndex=t},getPastTransactionsList:function(){var t=this,e=this.id,s={ProductID:e};(0,i.request)(o.PastTransactionsListGet,s).then(function(e){console.log(e);var s=e.OrderList;s.map(function(t){t.percentage=(t.OrderMoneys/t.OrderPrimeCost*100).toFixed(2)}),t.pastList=s})},change:function(t){console.log(t)},hidePopup:function(){this.show=!this.show},getOrderDryingList:function(){var t=this,e=this.id,s={ProductID:e};(0,i.request)(o.OrderDryingListGet,s).then(function(e){t.showList=e.OrderList})},activePath:function(){var t=this.id;(0,i.navigateTo)("../activeBilList/activeBilList?id="+t)},productDetailsUparsePath:function(){var t=this.id;(0,i.navigateTo)("../productDetailsUparse/productDetailsUparse?id="+t)},websocket:function(){var e=this;t.connectSocket({url:"wss://websocket.tengpaisc.com:8888/"}),t.onSocketOpen(function(t){console.log("WebSocket连接已打开！"),p=!0;for(var s=0;s<g.length;s++)e.sendSocketMessage(g[s]);g=[],e.reqLogin(),e.msgSubscribe()}),t.onSocketError(function(t){console.log("WebSocket连接打开失败，请检查！")}),this.onSocketMessage()},sendSocketMessage:function(e){var s=JSON.stringify(e);console.log("发送数据",p,e),p?t.sendSocketMessage({data:s}):g.push(e)},onSocketMessage:function(){var e=this;return new Promise(function(s,r){t.onSocketMessage(function(t){console.log("收到服务器内容："+t.data);var r=JSON.parse(t.data);console.log(r),e.proccessMsg(),s(r)})})},reqLogin:function(){var e=u(r.default.mark(function e(){var s,n,o,a,c,u;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.GUID();case 2:s=e.sent,n="3957399",o=t.getStorageSync("SessionKey"),a=1,0,!1,c=(0,i.formatTime)(new Date),console.log(s),u={ActiveID:a,AppKey:n,SessionKey:o,msgID:s,msgType:3,msgTime:c},this.sendSocketMessage(u);case 12:case"end":return e.stop()}},e,this)}));function s(){return e.apply(this,arguments)}return s}(),msgSubscribe:function(){var t=u(r.default.mark(function t(){var e,s,n,o,a;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.GUID();case 2:e=t.sent,s=1,n="/Actives/"+s+"/",o=(0,i.formatTime)(new Date),a={Subscribe:n,msgID:e,msgType:0,msgTime:o},this.sendSocketMessage(a);case 8:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),proccessMsg:function(){var t=u(r.default.mark(function t(){var e,s,n,o,a,c,u;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.onSocketMessage();case 2:return e=t.sent,t.next=5,this.timerState();case 5:s=t.sent,n=e.msgType,console.log(e),t.prev=8,t.t0=n,t.next=0===t.t0?12:1===t.t0?14:2===t.t0?17:3===t.t0?19:4===t.t0?21:5===t.t0?23:8===t.t0?25:9===t.t0?31:10===t.t0?36:11===t.t0?40:44;break;case 12:return e.IsError?(0,i.showToast)("订阅失败："+e.ErrMsg):(0,i.showToast)(e.ErrMsg),t.abrupt("break",44);case 14:return e.IsError?(0,i.showToast)("报名失败："+e.ErrMsg):(0,i.showToast)(e.ErrMsg),this.seq="剩余举牌次数："+e.SeqBills+"次，已报名份数："+e.Signups+"份，还可报名："+e.SeqSignups+"份",t.abrupt("break",44);case 17:return e.IsError?(0,i.showToast)(e.ErrMsg):(this.MyBills="我的举牌次数："+e.MyBills+"次，剩余可用次数："+e.SeqBills+"次",(0,i.showToast)(e.ErrMsg)),t.abrupt("break",44);case 19:return e.IsError?(0,i.showToast)("登录失败："+e.ErrMsg):(this.UserID=e.UserID,(0,i.showToast)(e.ErrMsg)),t.abrupt("break",44);case 21:return e.IsError?(0,i.showToast)("托管失败!"+e.ErrMsg):this.tapbtn="取消托管",t.abrupt("break",44);case 23:return e.IsError?(0,i.showToast)("取消托管失败!"):this.tapbtn="取消托管",t.abrupt("break",44);case 25:return(0,i.showToast)("价格已更新......！"),this.BillStat="总举牌次数："+e.AllBills+"次",e.Bills.length>0&&(this.newprice="￥"+e.Bills[0].Price,this.newbill="领先人："+e.Bills[0].City,o=new Date,a=o.getTime()+e.SeqMiniSecounds,this.seqTime.setTime(a)),e.Bills.length>1&&(this.lastbills=e.Bills),1===e.Bills.length&&this.timerState(),t.abrupt("break",44);case 31:return c=new Date,u=c.getTime(),this.seqTime.setTime(u+e.SeqMiniSecounds),console.log(this.seqTime),t.abrupt("break",44);case 36:return clearInterval(s),this.times="等待首牌",this.newprice="￥"+e.currPrice,t.abrupt("break",44);case 40:return clearInterval(s),this.times="已成交",this.UserID===e.WinsBill.UserID&&(0,i.showModal)("恭喜，您已中拍！点击确定去填写订单信息吧！"),t.abrupt("break",44);case 44:console.log(n),t.next=51;break;case 47:t.prev=47,t.t1=t["catch"](8),console.error("处理消息出错："),console.error(t.t1);case 51:case"end":return t.stop()}},t,this,[[8,47]])}));function e(){return t.apply(this,arguments)}return e}(),btnTap:function(){var t=u(r.default.mark(function t(){var e,s,n,o,a,c,u,l,h;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e="举牌",s=3,n=1,t.next=5,this.GUID();case 5:o=t.sent,a=(0,i.formatTime)(new Date),t.t0=e,t.next="报名"===t.t0?10:"举牌"===t.t0?13:"托管"===t.t0?16:"取消托管"===t.t0?19:22;break;case 10:return c={ActiveID:s,Shares:1,msgID:o,msgType:1,msgTime:a},this.sendSocketMessage(c),t.abrupt("break",22);case 13:return u={ActiveID:s,Price:n,msgID:o,msgType:2,msgTime:a},this.sendSocketMessage(u),t.abrupt("break",22);case 16:return l={ActiveID:s,msgID:o,msgType:4,msgTime:a},this.sendSocketMessage(l),t.abrupt("break",22);case 19:return h={ActiveID:s,msgID:o,msgType:5,msgTime:a},this.sendSocketMessage(h),t.abrupt("break",22);case 22:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),seqDisplay:function(){var t=this.seqTime,e=new Date,s=t-e,r=Math.floor(s/1e3),n=Math.floor(Math.floor(r/60)/60)%24,i=Math.floor(r/60)%60,o=r%60,a=Math.floor(s/100)%10;if(o<=0)this.times="";else{n<10&&(n="0"+n),i<10&&(i="0"+i),o<10&&(o="0"+o);var c=n+":"+i+":"+o+"."+a;this.times=c}},timerState:function(){var t=this;return new Promise(function(e,s){var r=setInterval(function(){t.seqDisplay()},100);e(r)})},GUID:function(){return new Promise(function(t,e){for(var s="",r=1;r<=32;r++){var n=Math.floor(16*Math.random()).toString(16);s+=n,8!=r&&12!=r&&16!=r&&20!=r||(s+="-")}t(s)})}}});e.default=m}).call(this,s("543d")["default"])},a653:function(t,e,s){"use strict";s.r(e);var r=s("551b"),n=s("c6f7");for(var i in n)"default"!==i&&function(t){s.d(e,t,function(){return n[t]})}(i);s("0c1d");var o=s("2877"),a=Object(o["a"])(n["default"],r["a"],r["b"],!1,null,null,null);e["default"]=a.exports},c6f7:function(t,e,s){"use strict";s.r(e);var r=s("9795"),n=s.n(r);for(var i in r)"default"!==i&&function(t){s.d(e,t,function(){return r[t]})}(i);e["default"]=n.a},ed1d:function(t,e,s){}},[["2baa","common/runtime","common/vendor"]]]);