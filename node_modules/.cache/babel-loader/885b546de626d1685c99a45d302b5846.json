{"remainingRequest":"/Users/lee/Desktop/github/mall-project/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-2!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--18-0!/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lee/Desktop/github/mall-project/src/components/robby-image-upload/robby-image-upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lee/Desktop/github/mall-project/src/components/robby-image-upload/robby-image-upload.vue","mtime":1564276964580},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":1560261191357},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1563798331564},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1563798331564},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js","mtime":1563798333387},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":1563798331564}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _util = require(\"@/common/utils/util\");\n\nvar _api = require(\"@/common/config/api\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _self;\n\nvar _default = {\n  name: 'robby-image-upload',\n  props: ['value', 'enableDel', 'enableAdd', 'enableDrag', 'formData', 'limit', 'fileKeyName', 'showUploadProgress'],\n  data: function data() {\n    return {\n      imageBasePos: {\n        x0: -1,\n        y0: -1,\n        w: -1,\n        h: -1\n      },\n      showMoveImage: false,\n      moveImagePath: '',\n      moveLeft: 0,\n      moveTop: 0,\n      deltaLeft: 0,\n      deltaTop: 0,\n      dragIndex: null,\n      targetImageIndex: null,\n      picUrl: [],\n      imageUpload: \"/static/icon/icon_image_upload.png\"\n    };\n  },\n  computed: {\n    posMoveImageLeft: function posMoveImageLeft() {\n      return this.moveLeft + 'px';\n    },\n    posMoveImageTop: function posMoveImageTop() {\n      return this.moveTop + 'px';\n    },\n    isShowDel: function isShowDel() {\n      if (this.enableDel === false) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n    isShowAdd: function isShowAdd() {\n      if (this.enableAdd === false) {\n        return false;\n      }\n\n      if (this.limit && this.value.length >= this.limit) {\n        return false;\n      }\n\n      return true;\n    },\n    isDragable: function isDragable() {\n      if (this.enableDrag === false) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  },\n  methods: {\n    selectImage: function selectImage() {\n      _self = this;\n\n      if (!_self.value) {\n        _self.value = [];\n      }\n\n      uni.chooseImage({\n        count: _self.limit ? _self.limit - _self.value.length : 999,\n        success: function success(e) {\n          var imagePathArr = e.tempFilePaths; //如果设置了limit限制，在web上count参数无效，这里做判断控制选择的数量是否合要求\n          //在非微信小程序里，虽然可以选多张，但选择的结果会被截掉\n          //在app里，会自动做选择数量的限制\n\n          if (_self.limit) {\n            var availableImageNumber = _self.limit - _self.value.length;\n\n            if (availableImageNumber < imagePathArr.length) {\n              var title = \"\\u56FE\\u7247\\u603B\\u6570\\u9650\\u5236\\u4E3A\".concat(_self.limit, \"\\u5F20\\uFF0C\\u5F53\\u524D\\u8FD8\\u53EF\\u4EE5\\u9009\").concat(availableImageNumber, \"\\u5F20\");\n              (0, _util.showToast)(title);\n              return;\n            }\n          }\n\n          console.log(imagePathArr);\n          imagePathArr.forEach(function (item) {\n            _self.uploadImage(item);\n          });\n\n          for (var i = 0; i < imagePathArr.length; i++) {\n            _self.value.push(imagePathArr[i]);\n          }\n        }\n      });\n    },\n    uploadImage: function uploadImage(filePath) {\n      var _this = this;\n\n      var data = {};\n      (0, _util.upload)(_api.OrderDryingUpload, data, filePath).then(function (res) {\n        console.log(res);\n        var data = JSON.parse(res);\n        console.log(data.PicUrl);\n        console.log(_self.picUrl);\n        var picUrl = data.PicUrl;\n        console.log(_self.picUrl, picUrl);\n        _self.picUrl = _self.picUrl.concat(data.PicUrl);\n\n        _this.$emit('add', {\n          currentImage: picUrl,\n          allImages: _self.picUrl\n        });\n      });\n    },\n    deleteImage: function deleteImage(e) {\n      var imageIndex = e.currentTarget.dataset.index;\n      var deletedImagePath = this.value[imageIndex];\n      this.value.splice(imageIndex, 1);\n      this.picUrl.splice(imageIndex, 1);\n      this.$emit('delete', {\n        currentImage: deletedImagePath,\n        allImages: this.picUrl\n      });\n      this.$emit('input', this.value);\n    },\n    previewImage: function previewImage(e) {\n      var imageIndex = e.currentTarget.dataset.index;\n      uni.previewImage({\n        current: this.value[imageIndex],\n        indicator: \"number\",\n        loop: \"true\",\n        urls: this.value\n      });\n    },\n    initImageBasePos: function initImageBasePos() {\n      var paddingRate = 0.024;\n      _self = this; //计算图片基准位置\n\n      uni.getSystemInfo({\n        success: function success(obj) {\n          var screenWidth = obj.screenWidth;\n          var leftPadding = Math.ceil(paddingRate * screenWidth);\n          var imageWidth = Math.ceil((screenWidth - 2 * leftPadding) / 4);\n          _self.imageBasePos.x0 = leftPadding;\n          _self.imageBasePos.w = imageWidth;\n          _self.imageBasePos.h = imageWidth;\n        }\n      });\n    },\n    findOverlapImage: function findOverlapImage(posX, posY) {\n      var rows = Math.floor((posX - this.imageBasePos.x0) / this.imageBasePos.w);\n      var cols = Math.floor((posY - this.imageBasePos.y0) / this.imageBasePos.h);\n      var indx = cols * 4 + rows;\n      return indx;\n    },\n    isDragging: function isDragging(indx) {\n      return this.dragIndex === indx;\n    },\n    start: function start(e) {\n      if (!this.isDragable) {\n        return;\n      }\n\n      this.dragIndex = e.currentTarget.dataset.index;\n      this.moveImagePath = this.value[this.dragIndex];\n      this.movePicImagePath = this.picUrl[this.dragIndex];\n      this.showMoveImage = true; //计算纵向图片基准位置\n\n      if (this.imageBasePos.y0 === -1) {\n        this.initImageBasePos();\n        var basePosY = Math.floor(this.dragIndex / 4) * this.imageBasePos.h;\n        var currentImageOffsetTop = e.currentTarget.offsetTop;\n        this.imageBasePos.y0 = currentImageOffsetTop - basePosY;\n      } //设置选中图片当前左上角的坐标\n\n\n      this.moveLeft = e.target.offsetLeft;\n      this.moveTop = e.target.offsetTop;\n    },\n    move: function move(e) {\n      if (!this.isDragable) {\n        return;\n      }\n\n      var touch = e.touches[0];\n      this.targetImageIndex = this.findOverlapImage(touch.clientX, touch.clientY); //初始化deltaLeft/deltaTop\n\n      if (this.deltaLeft === 0) {\n        this.deltaLeft = touch.clientX - this.moveLeft;\n        this.deltaTop = touch.clientY - this.moveTop;\n      } //设置移动图片位置\n\n\n      this.moveLeft = touch.clientX - this.deltaLeft;\n      this.moveTop = touch.clientY - this.deltaTop;\n    },\n    stop: function stop(e) {\n      if (!this.isDragable) {\n        return;\n      }\n\n      if (this.dragIndex !== null && this.targetImageIndex !== null) {\n        if (this.targetImageIndex < 0) {\n          this.targetImageIndex = 0;\n        }\n\n        if (this.targetImageIndex >= this.value.length) {\n          this.targetImageIndex = this.value.length - 1;\n        } //交换图片\n\n\n        if (this.dragIndex !== this.targetImageIndex) {\n          this.value[this.dragIndex] = this.value[this.targetImageIndex];\n          this.value[this.targetImageIndex] = this.moveImagePath;\n          this.picUrl[this.dragIndex] = this.picUrl[this.targetImageIndex];\n          this.picUrl[this.targetImageIndex] = this.movePicImagePath;\n        }\n      }\n\n      this.dragIndex = null;\n      this.targetImageIndex = null;\n      this.deltaLeft = 0;\n      this.deltaTop = 0;\n      this.showMoveImage = false;\n      console.log(this.value);\n      console.log(this.picUrl);\n      this.$emit('input', this.value);\n      this.$emit('picUrlInput', this.picUrl);\n    }\n  }\n};\nexports.default = _default;",{"version":3,"sources":["robby-image-upload.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n\t<view class=\"imageUploadContainer\">\n\t\t<view class=\"imageUploadList\">\n\t\t\t<view class=\"imageItem\" v-bind:key=\"index\" v-for=\"(path,index) in value\">\n\t\t\t\t<image :src=\"path\" :class=\"{'dragging':isDragging(index)}\" draggable=\"true\" @tap=\"previewImage\" :data-index=\"index\" @touchstart=\"start\" @touchmove=\"move\" @touchend=\"stop\"></image>\n\t\t\t\t<view v-if=\"isShowDel\" class=\"imageDel\" @tap=\"deleteImage\" :data-index=\"index\">x</view>\n\t\t\t</view>\n\t\t\t<view v-if=\"isShowAdd\" class=\"imageUpload\" @tap=\"selectImage\">\n\t\t\t\t<view class=\"upload\">\n\t\t\t\t\t<img class=\"image-add\" :src=\"imageUpload\" />\n\t\t\t\t\t<view class=\"image-upload-text\">添加图片</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<image v-if=\"showMoveImage\" class=\"moveImage\" :style=\"{left:posMoveImageLeft, top:posMoveImageTop}\" :src=\"moveImagePath\"></image>\n\t</view>\n</template>\n\n<script>\n\tvar _self;\n\timport { upload, navigateTo, showToast } from \"@/common/utils/util\";\n  import { OrderDryingUpload } from \"@/common/config/api\";\n\texport default {\n\t\tname:'robby-image-upload',\n\t\tprops: ['value','enableDel','enableAdd','enableDrag','formData','limit','fileKeyName','showUploadProgress'],\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\timageBasePos:{\n\t\t\t\t\tx0: -1,\n\t\t\t\t\ty0: -1,\n\t\t\t\t\tw:-1,\n\t\t\t\t\th:-1,\n\t\t\t\t},\n\t\t\t\tshowMoveImage: false,\n\t\t\t\tmoveImagePath: '',\n\t\t\t\tmoveLeft: 0,\n\t\t\t\tmoveTop: 0,\n\t\t\t\tdeltaLeft: 0,\n\t\t\t\tdeltaTop: 0,\n\t\t\t\tdragIndex: null,\n\t\t\t\ttargetImageIndex: null,\n\t\t\t\tpicUrl: [],\n\t\t\t\timageUpload: \"/static/icon/icon_image_upload.png\"\n\t\t\t}\n\t\t},\n\t\tcomputed:{\n\t\t\tposMoveImageLeft: function(){ \n\t\t\t\treturn this.moveLeft + 'px'\n\t\t\t},\n\t\t\tposMoveImageTop: function(){\n\t\t\t\treturn this.moveTop + 'px'\n\t\t\t},\n\t\t\tisShowDel: function(){\n\t\t\t\tif(this.enableDel === false){\n\t\t\t\t\treturn false\n\t\t\t\t}else{\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t},\n\t\t\tisShowAdd: function(){\n\t\t\t\tif(this.enableAdd === false){\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(this.limit && this.value.length >= this.limit){\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn true\n\t\t\t},\n\t\t\tisDragable: function(){\n\t\t\t\tif(this.enableDrag === false){\n\t\t\t\t\treturn false\n\t\t\t\t}else{\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tselectImage: function(){\n\t\t\t\t_self = this\n\t\t\t\tif(!_self.value){\n\t\t\t\t\t_self.value = []\n\t\t\t\t} \n\t\t\t\t\n\t\t\t\tuni.chooseImage({\n\t\t\t\t\tcount: _self.limit ? (_self.limit - _self.value.length) : 999,\n\t\t\t\t\tsuccess: (e) => {\n\t\t\t\t\t\tvar imagePathArr = e.tempFilePaths\n\t\t\t\t\t\t//如果设置了limit限制，在web上count参数无效，这里做判断控制选择的数量是否合要求\n\t\t\t\t\t\t//在非微信小程序里，虽然可以选多张，但选择的结果会被截掉\n\t\t\t\t\t\t//在app里，会自动做选择数量的限制\n\t\t\t\t\t\tif(_self.limit){\n\t\t\t\t\t\t\tvar availableImageNumber = _self.limit - _self.value.length\n\t\t\t\t\t\t\tif(availableImageNumber < imagePathArr.length){\n\t\t\t\t\t\t\t\tlet title = `图片总数限制为${_self.limit}张，当前还可以选${availableImageNumber}张`\n\t\t\t\t\t\t\t\tshowToast(title)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(imagePathArr)\n\t\t\t\t\t\timagePathArr.forEach((item) => {\n\t\t\t\t\t\t\t_self.uploadImage(item)\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfor(let i=0; i<imagePathArr.length;i++){\n\t\t\t\t\t\t\t_self.value.push(imagePathArr[i])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tuploadImage: function(filePath) {\n\t\t\t\tlet data = {};\n\t\t\t\tupload(OrderDryingUpload, data, filePath).then((res) => {\n\t\t\t\t\tconsole.log(res)\n\t\t\t\t\tlet data = JSON.parse(res)\n\t\t\t\t\tconsole.log(data.PicUrl)\n\t\t\t\t\tconsole.log(_self.picUrl)\n\t\t\t\t\tlet picUrl = data.PicUrl\n\t\t\t\t\tconsole.log(_self.picUrl, picUrl)\n\t\t\t\t\t_self.picUrl = _self.picUrl.concat(data.PicUrl);\n\t\t\t\t\tthis.$emit('add',{\n\t\t\t\t\t\tcurrentImage: picUrl,\n\t\t\t\t\t\tallImages: _self.picUrl\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t},\n\t\t\tdeleteImage: function(e){\n\t\t\t\tvar imageIndex = e.currentTarget.dataset.index\n\t\t\t\tvar deletedImagePath = this.value[imageIndex]\n\t\t\t\tthis.value.splice(imageIndex, 1) \n\t\t\t\tthis.picUrl.splice(imageIndex, 1)\n\t\t\t\t\n\t\t\t\tthis.$emit('delete',{\n\t\t\t\t\tcurrentImage: deletedImagePath,\n\t\t\t\t\tallImages: this.picUrl\n\t\t\t\t})\n\t\t\t\tthis.$emit('input', this.value)\n\t\t\t},\n\t\t\tpreviewImage: function(e){\n\t\t\t\tvar imageIndex = e.currentTarget.dataset.index\n\t\t\t\tuni.previewImage({\n\t\t\t\t\tcurrent: this.value[imageIndex],\n\t\t\t\t\tindicator: \"number\",\n\t\t\t\t\tloop: \"true\",\n\t\t\t\t\turls:this.value\n\t\t\t\t})\n\t\t\t},\n\t\t\tinitImageBasePos: function(){\n\t\t\t\tlet paddingRate = 0.024\n\t\t\t\t_self = this\n\t\t\t\t//计算图片基准位置\n\t\t\t\tuni.getSystemInfo({\n\t\t\t\t\tsuccess: function(obj) {\n\t\t\t\t\t\tlet screenWidth = obj.screenWidth\n\t\t\t\t\t\tlet leftPadding = Math.ceil(paddingRate * screenWidth)\n\t\t\t\t\t\tlet imageWidth = Math.ceil((screenWidth - 2*leftPadding)/4)\n\t\t\t\t\t\t\n\t\t\t\t\t\t_self.imageBasePos.x0 = leftPadding\n\t\t\t\t\t\t_self.imageBasePos.w = imageWidth\n\t\t\t\t\t\t_self.imageBasePos.h = imageWidth\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tfindOverlapImage: function(posX, posY){\n\t\t\t\tlet rows = Math.floor((posX-this.imageBasePos.x0)/this.imageBasePos.w)\n\t\t\t\tlet cols = Math.floor((posY-this.imageBasePos.y0)/this.imageBasePos.h)\n\t\t\t\tlet indx = cols*4 + rows\n\t\t\t\treturn indx\n\t\t\t},\n\t\t\tisDragging: function(indx){\n\t\t\t\treturn this.dragIndex === indx\n\t\t\t},\n\t\t\tstart: function(e){\n\t\t\t\tif(!this.isDragable){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.dragIndex = e.currentTarget.dataset.index\n\t\t\t\tthis.moveImagePath = this.value[this.dragIndex]\n\t\t\t\tthis.movePicImagePath = this.picUrl[this.dragIndex]\n\t\t\t\tthis.showMoveImage = true\n\t\t\t\t\n\t\t\t\t//计算纵向图片基准位置\n\t\t\t\tif(this.imageBasePos.y0 === -1){\n\t\t\t\t\tthis.initImageBasePos()\n\t\t\t\t\t\n\t\t\t\t\tlet basePosY = Math.floor(this.dragIndex / 4) * this.imageBasePos.h\n\t\t\t\t\tlet currentImageOffsetTop = e.currentTarget.offsetTop\n\t\t\t\t\tthis.imageBasePos.y0 = currentImageOffsetTop - basePosY\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//设置选中图片当前左上角的坐标\n\t\t\t\tthis.moveLeft = e.target.offsetLeft\n\t\t\t\tthis.moveTop = e.target.offsetTop\n\t\t\t},\n\t\t\tmove: function(e){\n\t\t\t\tif(!this.isDragable){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst touch = e.touches[0]\n\t\t\t\tthis.targetImageIndex = this.findOverlapImage(touch.clientX, touch.clientY)\n\t\t\t\t\n\t\t\t\t//初始化deltaLeft/deltaTop\n\t\t\t\tif(this.deltaLeft === 0){\n\t\t\t\t\tthis.deltaLeft = touch.clientX - this.moveLeft\n\t\t\t\t\tthis.deltaTop = touch.clientY - this.moveTop \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//设置移动图片位置\n\t\t\t\tthis.moveLeft = touch.clientX - this.deltaLeft\n\t\t\t\tthis.moveTop = touch.clientY - this.deltaTop\n\t\t\t},\n\t\t\tstop: function(e){\n\t\t\t\tif(!this.isDragable){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif(this.dragIndex !== null && this.targetImageIndex !== null){\n\t\t\t\t\tif(this.targetImageIndex<0){\n\t\t\t\t\t\tthis.targetImageIndex = 0\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tif(this.targetImageIndex>=this.value.length){\n\t\t\t\t\t\tthis.targetImageIndex = this.value.length-1\n\t\t\t\t\t}\n\t\t\t\t\t//交换图片\n\t\t\t\t\tif(this.dragIndex !== this.targetImageIndex){\n\t\t\t\t\t\tthis.value[this.dragIndex] = this.value[this.targetImageIndex]\n\t\t\t\t\t\tthis.value[this.targetImageIndex] = this.moveImagePath\n\t\t\t\t\t\tthis.picUrl[this.dragIndex] = this.picUrl[this.targetImageIndex]\n\t\t\t\t\t\tthis.picUrl[this.targetImageIndex] = this.movePicImagePath\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.dragIndex = null\n\t\t\t\tthis.targetImageIndex = null\n\t\t\t\tthis.deltaLeft = 0\n\t\t\t\tthis.deltaTop = 0\n\t\t\t\tthis.showMoveImage = false\n\t\t\t\tconsole.log(this.value)\n\t\t\t\tconsole.log(this.picUrl)\n\t\t\t\tthis.$emit('input', this.value)\n\t\t\t\tthis.$emit('picUrlInput', this.picUrl)\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.imageUploadContainer{\n\t\tpadding: 10upx 5upx;\n\t\tmargin: 10upx 5upx;\n\t}\n\t\n\t.dragging{\n\t\ttransform: scale(1.2)\n\t}\n\t\n\t.imageUploadList{\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t}\n\t\n\t.imageItem, .imageUpload{\n\t\twidth: 160upx;\n\t\theight: 160upx;\n\t\tmargin: 10upx;\n\t}\n\t\n\t.imageDel{\n\t\tposition: relative;\n\t\tleft: 120upx;\n\t\tbottom: 165upx;\n\t\tbackground-color: rgba(0,0,0,0.5);\n\t\twidth: 36upx;\n\t\ttext-align: center;\n\t\tline-height: 35upx;\n\t\tborder-radius: 17upx;\n\t\tcolor: white;\n\t\tfont-size: 30upx;\n\t\tpadding-bottom: 2upx;\n\t}\n\t\n\t.imageItem image, .moveImage{\n\t\twidth: 160upx;\n\t\theight: 160upx;\n\t\tborder-radius: 8upx;\n\t}\n\t\n\t.imageUpload{\n\t\tline-height: 130upx;\n\t\ttext-align: center;\n\t\tfont-size: 150upx;\n\t\tcolor: #D9D9D9;\n\t\tborder: 1px solid #D9D9D9;\n\t\tborder-radius: 8upx;\n\t}\n\t\n\t.upload {\n\t\tpadding: 20upx 0;\n\t}\n\n\t.image-add {\n\t\twidth: 48upx;\n\t\theight: 48upx;\n\t}\n\n\t.image-upload-text {\n\t\tfont-size: 24upx;\n\t\tcolor: #b0b0b0;\n\t}\n\n\t.moveImage{\n\t\tposition: absolute;\n\t}\n</style>"],"sourceRoot":"src/components/robby-image-upload"}]}