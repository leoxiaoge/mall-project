{"remainingRequest":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lee/Desktop/github/mall-project/src/pages/ucenter/login/login.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/lee/Desktop/github/mall-project/src/pages/ucenter/login/login.vue","mtime":1564007773910},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/babel-loader/lib/index.js","mtime":1560261191357},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/ts-loader/index.js","mtime":1560261210667},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1563798331564},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1563798331564},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js","mtime":1563798333387},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":1563798331564}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  import Vue from 'vue'\n  import { mapState, mapMutations } from 'vuex'\n  import { request, navigateTo, navigateBack, showToast } from '@/common/utils/util'\n  import { UserLogin, GetLoginCode, GetWXOpenID } from '@/common/config/api'\n  import uniIcon from '@/components/uni-icon/uni-icon.vue'\n\texport default Vue.extend({\n    components: {\n\t\t\tuniIcon\n    },\n    computed: {\n\t\t\t...mapState(['hasLogin'])\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n        wxFace: '',\n        wxNick: '',\n        refUserID: '',\n        logo: '/static/icon/icon_login.png',\n        checked: true,\n        Mobile: '',\n        LoginCode: '',\n        loading: false,\n        time: '获取验证码',\n        currentTime: 60,\n        disabled: false,\n        interval: ''\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n      console.log(this.$store.state)\n      uni.getProvider({\n        service: 'oauth',\n        success: (res: any) =>{\n            console.log(res.provider)\n            if (~res.provider.indexOf('weixin')) {\n                uni.login({\n                    provider: 'weixin',\n                    success: (loginRes: any) => {\n                      console.log(JSON.stringify(loginRes));\n                      let JSCode = loginRes.code\n                      let data = {\n                        JSCode: JSCode\n                      }\n                      request(GetWXOpenID, data).then((res: any) => {\n                        console.log(res)\n                        let OpenID = res.OpenID\n                        uni.setStorageSync('OpenID', OpenID)\n                      })\n                    }\n                });\n            }\n        }\n    });\n    },\n    onUnload() {\n      let interval: any = this.interval\n      clearInterval(interval)\n    },\n\t\tmethods: {\n      ...mapMutations(['login']),\n      mobileInput(e: any) {\n        console.log(e)\n        this.Mobile = e.detail.value\n      },\n      codeInput(e: any) {\n        console.log(e)\n        this.LoginCode = e.detail.value\n      },\n      getCode(e: any) {\n        console.log(e)\n        let Mobile = this.Mobile\n        if (!Mobile) {\n          showToast('手机号码不能为空！')\n          return\n        }\n        this.getLoginCode()\n        let currentTime: any = this.currentTime\n        this.time = currentTime + 's后可重发'\n        this.disabled = true\n        let interval: any = setInterval(() => {\n          this.time = (currentTime - 1) + 's后可重发'\n          currentTime--\n          if (currentTime <= 0) {\n            clearInterval(interval)\n            this.time = '重新获取'\n            this.currentTime = 60\n            this.disabled = false\n          }\n        }, 1000)\n        this.interval = interval\n      },\n      getLoginCode() {\n        let Mobile = this.Mobile\n\t\t\t\tlet data = {\n\t\t\t\t\tMobile: Mobile\n        }\n\t\t  \trequest(GetLoginCode, data).then((res: any) => {\n          console.log(res)\n          showToast('发送成功！')\n        })\n      },\n      radioClick() {\n        this.checked = !this.checked\n      },\n      wxLogin(e: any) {\n        console.log(e)\n        let userInfo = e.detail.userInfo;\n        this.wxFace = userInfo.avatarUrl;\n        this.wxNick = userInfo.nickName;\n        this.userLogin();\n      },\n      userLogin() {\n        let Mobile = this.Mobile;\n        // let Mobile = '13723750893';\n        let LoginCode  = this.LoginCode;\n        let wxFace = this.wxFace;\n        let wxNick = this.wxNick;\n        let refUserID = this.refUserID\n        if (uni.getStorageSync(\"scene\")) {\n          refUserID = uni.getStorageSync(\"scene\")\n        }\n        if (!Mobile) {\n          showToast('手机号码不能为空！')\n          return\n        }\n        if (!LoginCode) {\n          showToast('验证码不能为空！')\n          return\n        }\n        this.loading = true;\n\t\t\t\tlet data = {\n          Mobile: Mobile,\n          LoginCode: LoginCode,\n          wxFace: wxFace,\n          wxNick: wxNick,\n          RefUserID: refUserID\n        }\n\t\t  \trequest(UserLogin, data).then((res: any) => {\n          console.log(res)\n          this.loading = false;\n          let SessionKey = res.SessionKey\n          let UserInfo = res.UserInfo\n          uni.setStorageSync('SessionKey', SessionKey)\n          uni.setStorageSync('UserInfo', UserInfo)\n          showToast('登录成功！')\n          navigateBack(1);\n        })\n      },\n      getuserinfo(e: any) {\n        console.log(e)\n      }\n\t\t}\n\t})\n",{"version":3,"sources":["login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"login.vue","sourceRoot":"src/pages/ucenter/login","sourcesContent":["\n<template>\n\t<view class=\"container\">\n    <view class=\"i-header-logo\">\n\t\t\t<image :src=\"logo\"></image>\n\t\t</view>\n    <view class=\"i-login-mobile i-border-bottom i-flex-between\">\n      <view class=\"i-login-content i-flex\">\n        <image class=\"i-login-mobile-image\" />\n        <input class=\"i-login-mobile-input\" type=\"number\" :value=\"Mobile\" placeholder=\"请输入手机号码\" @input=\"mobileInput\" />\n      </view>\n      <view class=\"i-login-set-code\">\n        <button class=\"i-button-get\" :disabled=\"disabled\" @click=\"getCode\" >\n          {{time}}\n        </button>\n      </view>\n    </view>\n    <view class=\"i-login-code i-border-bottom\">\n      <view class=\"i-login-content i-flex\">\n        <image class=\"i-login-code-image\" />\n        <input class=\"i-login-code-input\" type=\"number\" :value=\"LoginCode\" placeholder=\"验证码\" @input=\"codeInput\" />\n      </view>\n    </view>\n    <view class=\"i-login-radio\">\n      <label class=\"radio\">\n        <radio @click=\"radioClick\" :checked=\"checked\" color=\"#fe7f00\" />我已阅读并同意《腾拍商场购物协议》\n      </label>\n    </view>\n    <view class=\"i-login-button-view\">\n      <!-- #ifdef MP-WEIXIN -->\n      <button class=\"btn i-login-button\" :loading=\"loading\" open-type=\"getUserInfo\" @getuserinfo=\"wxLogin\">登录</button>\n\t\t\t<!-- #endif -->\n      <!-- #ifdef H5 -->\n      <button class=\"btn i-login-button\" :loading=\"loading\" @click=\"userLogin\">登录</button>\n\t\t\t<!-- #endif -->\n    </view>\n  </view>\n</template>\n\n<script lang=\"ts\">\n  import Vue from 'vue'\n  import { mapState, mapMutations } from 'vuex'\n  import { request, navigateTo, navigateBack, showToast } from '@/common/utils/util'\n  import { UserLogin, GetLoginCode, GetWXOpenID } from '@/common/config/api'\n  import uniIcon from '@/components/uni-icon/uni-icon.vue'\n\texport default Vue.extend({\n    components: {\n\t\t\tuniIcon\n    },\n    computed: {\n\t\t\t...mapState(['hasLogin'])\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n        wxFace: '',\n        wxNick: '',\n        refUserID: '',\n        logo: '/static/icon/icon_login.png',\n        checked: true,\n        Mobile: '',\n        LoginCode: '',\n        loading: false,\n        time: '获取验证码',\n        currentTime: 60,\n        disabled: false,\n        interval: ''\n\t\t\t}\n\t\t},\n\t\tonLoad(options) {\n      console.log(this.$store.state)\n      uni.getProvider({\n        service: 'oauth',\n        success: (res: any) =>{\n            console.log(res.provider)\n            if (~res.provider.indexOf('weixin')) {\n                uni.login({\n                    provider: 'weixin',\n                    success: (loginRes: any) => {\n                      console.log(JSON.stringify(loginRes));\n                      let JSCode = loginRes.code\n                      let data = {\n                        JSCode: JSCode\n                      }\n                      request(GetWXOpenID, data).then((res: any) => {\n                        console.log(res)\n                        let OpenID = res.OpenID\n                        uni.setStorageSync('OpenID', OpenID)\n                      })\n                    }\n                });\n            }\n        }\n    });\n    },\n    onUnload() {\n      let interval: any = this.interval\n      clearInterval(interval)\n    },\n\t\tmethods: {\n      ...mapMutations(['login']),\n      mobileInput(e: any) {\n        console.log(e)\n        this.Mobile = e.detail.value\n      },\n      codeInput(e: any) {\n        console.log(e)\n        this.LoginCode = e.detail.value\n      },\n      getCode(e: any) {\n        console.log(e)\n        let Mobile = this.Mobile\n        if (!Mobile) {\n          showToast('手机号码不能为空！')\n          return\n        }\n        this.getLoginCode()\n        let currentTime: any = this.currentTime\n        this.time = currentTime + 's后可重发'\n        this.disabled = true\n        let interval: any = setInterval(() => {\n          this.time = (currentTime - 1) + 's后可重发'\n          currentTime--\n          if (currentTime <= 0) {\n            clearInterval(interval)\n            this.time = '重新获取'\n            this.currentTime = 60\n            this.disabled = false\n          }\n        }, 1000)\n        this.interval = interval\n      },\n      getLoginCode() {\n        let Mobile = this.Mobile\n\t\t\t\tlet data = {\n\t\t\t\t\tMobile: Mobile\n        }\n\t\t  \trequest(GetLoginCode, data).then((res: any) => {\n          console.log(res)\n          showToast('发送成功！')\n        })\n      },\n      radioClick() {\n        this.checked = !this.checked\n      },\n      wxLogin(e: any) {\n        console.log(e)\n        let userInfo = e.detail.userInfo;\n        this.wxFace = userInfo.avatarUrl;\n        this.wxNick = userInfo.nickName;\n        this.userLogin();\n      },\n      userLogin() {\n        let Mobile = this.Mobile;\n        // let Mobile = '13723750893';\n        let LoginCode  = this.LoginCode;\n        let wxFace = this.wxFace;\n        let wxNick = this.wxNick;\n        let refUserID = this.refUserID\n        if (uni.getStorageSync(\"scene\")) {\n          refUserID = uni.getStorageSync(\"scene\")\n        }\n        if (!Mobile) {\n          showToast('手机号码不能为空！')\n          return\n        }\n        if (!LoginCode) {\n          showToast('验证码不能为空！')\n          return\n        }\n        this.loading = true;\n\t\t\t\tlet data = {\n          Mobile: Mobile,\n          LoginCode: LoginCode,\n          wxFace: wxFace,\n          wxNick: wxNick,\n          RefUserID: refUserID\n        }\n\t\t  \trequest(UserLogin, data).then((res: any) => {\n          console.log(res)\n          this.loading = false;\n          let SessionKey = res.SessionKey\n          let UserInfo = res.UserInfo\n          uni.setStorageSync('SessionKey', SessionKey)\n          uni.setStorageSync('UserInfo', UserInfo)\n          showToast('登录成功！')\n          navigateBack(1);\n        })\n      },\n      getuserinfo(e: any) {\n        console.log(e)\n      }\n\t\t}\n\t})\n</script>\n\n<style scoped>\n\n  page {\n    background-color: #fff;\n  }\n\n\t.i-header-logo {\n    padding:  80upx 0 80upx 0;\n    text-align: center;\n  }\n\n  .i-header-logo image {\n    width: 180upx;\n    height: 180upx;\n  }\n\n  .i-border-bottom {\n    border-bottom: 2upx solid #f4f4f4;\n  }\n\n  .i-login-mobile {\n    margin: 0 60upx;\n    padding: 20upx 0;\n  }\n  \n  .i-login-code {\n    margin: 0 60upx;\n    padding: 20upx 0;\n  }\n\n  .i-login-mobile-image {\n    background: url(https://api.tengpaisc.com/Resources/images/icon_login_mobile.png) center no-repeat;\n    background-size: 100%;\n    width: 36upx;\n    height: 52upx;\n  }\n\n  .i-login-code-image {\n    background: url(https://api.tengpaisc.com/Resources/images/icon_login_code.png) center no-repeat;\n    background-size: 100%;\n    width: 36upx;\n    height: 52upx;\n  }\n\n  .i-login-mobile-input {\n    min-width: 340upx;\n    margin-left: 20upx;\n  }\n\n  .i-login-code-input {\n    min-width: 560upx;\n    margin-left: 20upx;\n  }\n\n  .i-login-radio {\n    margin: 0 60upx;\n    padding: 20upx 0;\n  }\n\n  .i-button-get {\n    background-color: #fff;\n    font-size: 32upx;\n    color: #fe7f00;\n  }\n\n  uni-button:after {\n    content: \" \";\n    width: 200%;\n    height: 200%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    border: none;\n    -webkit-transform: scale(.5);\n    transform: scale(.5);\n    -webkit-transform-origin: 0 0;\n    transform-origin: 0 0;\n    box-sizing: border-box;\n    border-radius: 10px;\n  }\n\n  uni-button[disabled]:not([type]), uni-button[disabled][type=default] {\n    color: rgba(0,0,0,.3);\n    background-color: #fff;\n  }\n\n  .i-login-button {\n    font-size: 32upx;\n    line-height: 80upx;\n    width: 80%;\n    color: #fff;\n    background-color: #fe7f00;\n    border-radius: 100upx;\n    margin-top: 40upx;\n  }\n</style>\n"]}]}