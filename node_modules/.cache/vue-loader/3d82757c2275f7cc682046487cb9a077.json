{"remainingRequest":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lee/Desktop/github/mall-project/src/pages/mall/productDetailsPage/productDetailsPage.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/lee/Desktop/github/mall-project/src/pages/mall/productDetailsPage/productDetailsPage.vue","mtime":1563385439708},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/babel-loader/lib/index.js","mtime":1560261191357},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/ts-loader/index.js","mtime":1560261210667},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1561751947145},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1561751947145},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js","mtime":1554990705750},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":1561751947145}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\nimport {\n\trequest,\n\tnavigateTo,\n\tformatTime,\n\tshowToast,\n\tshowModal\n} from \"@/common/utils/util\";\nimport {\n\tProductGet,\n\tPastTransactionsListGet,\n\tOrderDryingListGet\n} from \"@/common/config/api\";\nimport iPast from \"@/components/i-past/i-past.vue\";\nimport iShow from \"@/components/i-show/i-show.vue\";\nimport iRule from \"@/components/i-rule/i-rule.vue\";\nimport iPopup from \"@/components/i-popup/i-popup.vue\";\nlet socketOpen: boolean = false;\nlet socketMsgQueue: any = [];\nexport default Vue.extend({\n\tcomponents: {\n\t\tiPast,\n\t\tiShow,\n\t\tiRule,\n\t\tiPopup\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tindicatorDots: true,\n\t\t\tautoplay: true,\n\t\t\tinterval: 2000,\n\t\t\tduration: 500,\n\t\t\tcircular: true,\n\t\t\tindicatorActiveColor: \"#fe7f00\",\n\t\t\tdisabled: false, // 按钮disabled\n\n\t\t\tswiper: [],\n\t\t\ttitle: \"服务\",\n\t\t\tid: \"\",\n\t\t\tproduct: \"\",\n\t\t\tnum: \"1\", // 剩余次数\n\n\t\t\ttabIndex: 0, // 默认往期成交\n\t\t\tpastList: [], // 往期成交列表\n\t\t\tshowList: [], // 晒单列表\n\t\t\truleList: \"\", // 竞拍规则\n\t\t\tshow: false, // 显示弹窗\n\n\t\t\tlabel: [\"零风险\", \"正品承诺\", \"极速发货\", \"公平公正\"],\n\t\t\ttab: [\"往期成交\", \"分享晒单\", \"竞拍规则\"],\n\t\t\tsrc: \"/static/icon_experience.png\",\n\t\t\tleading: \"/static/icon/icon_leading.png\",\n\n\t\t\tActiveID: \"\",\n\t\t\tPrice: \"\",\n\t\t\tmsgID: \"\",\n\t\t\tmsgType: \"\",\n\n\t\t\tseq: \"\", // 更新我的剩余举牌次数\n\t\t\tMyBills: \"\", // 举牌响应消息（包含我的举牌次数、剩余可用次数）\n\t\t\tUserID: \"\", // 登录成功，提示用户\n\t\t\ttapbtn: \"\", // 托管\n\t\t\tBillStat: \"\", // 总举牌次数\n\t\t\tnewprice: \"\", // 领先价格\n\t\t\tnewbill: \"\", // 领先人\n\t\t\tlastbills: [], // 出局列表\n\t\t\ttimes: \"\", // 倒计时\n\t\t\tseqTime: new Date(\"2019/7/20 10:29:35\")\n\t\t};\n\t},\n\tonLoad(options: any) {\n\t\tthis.id = options.id;\n\t\tthis.ActiveID = options.id;\n\t\tthis.UserID = uni.getStorageSync(\"SessionKey\").ID;\n\t\tthis.getProduct();\n\t\tthis.getPastTransactionsList();\n\t\tthis.getOrderDryingList();\n\t\tthis.websocket();\n\t},\n\tmethods: {\n\t\t// 获取产品详情\n\t\tgetProduct() {\n\t\t\tlet ProductID = this.id;\n\t\t\tlet data = {\n\t\t\t\tProductID: ProductID\n\t\t\t};\n\t\t\trequest(ProductGet, data).then((res: any) => {\n\t\t\t\tconsole.log(\"获取产品详情\", res);\n\t\t\t\tthis.product = res.Product;\n\t\t\t\tthis.swiper = res.Product.ProductPicList;\n\t\t\t\tthis.Price = res.Product.ProductPrice;\n\t\t\t});\n\t\t},\n\t\t// 选项卡\n\t\ttabClick(index: number) {\n\t\t\tthis.tabIndex = index;\n\t\t},\n\t\t// 往期成交列表\n\t\tgetPastTransactionsList() {\n\t\t\tlet ProductID = this.id;\n\t\t\tlet data = {\n\t\t\t\tProductID: ProductID\n\t\t\t};\n\t\t\trequest(PastTransactionsListGet, data).then((res: any) => {\n\t\t\t\tconsole.log(res);\n\t\t\t\tlet pastList = res.OrderList;\n\t\t\t\tpastList.map((item: any) => {\n\t\t\t\t\titem.percentage = (\n\t\t\t\t\t\t(item.OrderMoneys / item.OrderPrimeCost) *\n\t\t\t\t\t\t100\n\t\t\t\t\t).toFixed(2);\n\t\t\t\t});\n\t\t\t\tthis.pastList = pastList;\n\t\t\t});\n\t\t},\n\t\tchange(val: any) {\n\t\t\tconsole.log(val);\n\t\t\tthis.num = val;\n\t\t},\n\t\thidePopup() {\n\t\t\tthis.show = !this.show;\n\n\t\t},\n\t\t// 获取用户晒单列表\n\t\tgetOrderDryingList() {\n\t\t\tlet ProductID = this.id;\n\t\t\tlet data = {\n\t\t\t\tProductID: ProductID\n\t\t\t};\n\t\t\trequest(OrderDryingListGet, data).then((res: any) => {\n\t\t\t\tthis.showList = res.OrderList;\n\t\t\t});\n\t\t},\n\t\tactivePath() {\n\t\t\tlet id = this.id;\n\t\t\tnavigateTo(\"../activeBilList/activeBilList?id=\" + id);\n\t\t},\n\t\tproductDetailsUparsePath() {\n\t\t\tlet id = this.id;\n\t\t\tnavigateTo(\"../productDetailsUparse/productDetailsUparse?id=\" + id);\n\t\t},\n\t\twebsocket() {\n\t\t\tuni.connectSocket({\n\t\t\t\turl: \"wss://websocket.tengpaisc.com:8888/\"\n\t\t\t});\n\t\t\tuni.onSocketOpen((res: any) => {\n\t\t\t\tconsole.log(\"WebSocket连接已打开！\");\n\t\t\t\tsocketOpen = true;\n\t\t\t\tfor (let i = 0; i < socketMsgQueue.length; i++) {\n\t\t\t\t\tthis.sendSocketMessage(socketMsgQueue[i]);\n\t\t\t\t}\n\t\t\t\tsocketMsgQueue = [];\n\t\t\t\tthis.reqLogin();\n\t\t\t\tthis.msgSubscribe();\n\t\t\t});\n\t\t\tuni.onSocketError(res => {\n\t\t\t\tconsole.log(\"WebSocket连接打开失败，请检查！\");\n\t\t\t});\n\t\t\tthis.onSocketMessage();\n\t\t},\n\t\tsendSocketMessage(msg: any) {\n\t\t\tlet data: string = JSON.stringify(msg);\n\t\t\tconsole.log(\"发送数据\", socketOpen, msg);\n\t\t\tif (socketOpen) {\n\t\t\t\tuni.sendSocketMessage({\n\t\t\t\t\tdata: data\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocketMsgQueue.push(msg);\n\t\t\t}\n\t\t},\n\t\tonSocketMessage() {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tuni.onSocketMessage((res: any) => {\n\t\t\t\t\tconsole.log(\"收到服务器内容：\" + res.data);\n\t\t\t\t\tlet msg = JSON.parse(res.data);\n\t\t\t\t\tconsole.log(msg);\n\t\t\t\t\tthis.proccessMsg();\n\t\t\t\t\tsesolve(msg);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t// 向服务器发送登录请求\n\t\tasync reqLogin() {\n\t\t\tlet GUID: any = await this.GUID();\n\t\t\tconst Appkey = \"3957399\";\n\t\t\tconst SessionKey = uni.getStorageSync(\"SessionKey\");\n\t\t\tlet ActiveID = this.ActiveID;\n\t\t\tlet UserID = this.UserID;\n\t\t\tlet ConnectionState = false;\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tconsole.log(GUID);\n\t\t\tlet reqLogin: any = {\n\t\t\t\tActiveID: ActiveID,\n\t\t\t\tAppKey: Appkey,\n\t\t\t\tSessionKey: SessionKey,\n\t\t\t\tmsgID: GUID,\n\t\t\t\tmsgType: 3,\n\t\t\t\tmsgTime: msgTime\n\t\t\t};\n\t\t\tthis.sendSocketMessage(reqLogin);\n\t\t},\n\t\t// 发送对该活动的消息订阅\n\t\tasync msgSubscribe() {\n\t\t\tlet GUID: any = await this.GUID();\n\t\t\tlet ActiveID = this.ActiveID;\n\t\t\tlet url = \"/Actives/\" + ActiveID + \"/\";\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tlet reqSubscribe = {\n\t\t\t\tSubscribe: url,\n\t\t\t\tmsgID: GUID,\n\t\t\t\tmsgType: 0,\n\t\t\t\tmsgTime: msgTime\n\t\t\t};\n\t\t\tthis.sendSocketMessage(reqSubscribe);\n\t\t},\n\t\t// 处理消息的函数，用于解析从服务器webSocket收到的各种消息\n\t\tasync proccessMsg() {\n\t\t\tlet msg: any = await this.onSocketMessage();\n\t\t\tlet timerState: any = await this.timerState();\n\t\t\tlet msgType = msg.msgType;\n\t\t\tthis.msgType = msgType;\n\t\t\ttry {\n\t\t\t\tswitch (msgType) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\t// 订阅响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"订阅失败：\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\t// 报名响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"报名失败：\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 更新我的剩余举牌次数\n\t\t\t\t\t\tthis.seq =\n\t\t\t\t\t\t\t\"剩余举牌次数：\" +\n\t\t\t\t\t\t\tmsg.SeqBills +\n\t\t\t\t\t\t\t\"次，已报名份数：\" +\n\t\t\t\t\t\t\tmsg.Signups +\n\t\t\t\t\t\t\t\"份，还可报名：\" +\n\t\t\t\t\t\t\tmsg.SeqSignups +\n\t\t\t\t\t\t\t\"份\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\t// 举牌响应消息（包含我的举牌次数、剩余可用次数）\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.MyBills =\n\t\t\t\t\t\t\t\t\"我的举牌次数：\" +\n\t\t\t\t\t\t\t\tmsg.MyBills +\n\t\t\t\t\t\t\t\t\"次，剩余可用次数：\" +\n\t\t\t\t\t\t\t\tmsg.SeqBills +\n\t\t\t\t\t\t\t\t\"次\";\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\t// 登录响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"登录失败：\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 登录成功，提示用户\n\t\t\t\t\t\t\tthis.UserID = msg.UserID;\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\t// 托管响应\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"托管失败!\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.tapbtn = \"取消托管\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 5:\n\t\t\t\t\t\t// 取消托管响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"取消托管失败!\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.tapbtn = \"取消托管\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\t// 价格更新通知\n\t\t\t\t\t\tshowToast(\"价格已更新......！\");\n\t\t\t\t\t\t// 更新全部举牌次数、我的举牌次数、和最新价格\n\t\t\t\t\t\tthis.BillStat = \"总举牌次数：\" + msg.AllBills + \"次\";\n\t\t\t\t\t\t// 更新最后出价人信息\n\t\t\t\t\t\tif (msg.Bills.length > 0) {\n\t\t\t\t\t\t\tthis.newprice = \"￥\" + msg.Bills[0].Price;\n\t\t\t\t\t\t\tthis.newbill = \"领先人：\" + msg.Bills[0].City;\n\t\t\t\t\t\t\t// 计算剩余时长\n\t\t\t\t\t\t\tlet dt = new Date();\n\t\t\t\t\t\t\tlet tm = dt.getTime() + msg.SeqMiniSecounds;\n\t\t\t\t\t\t\tthis.seqTime.setTime(tm);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 更新最近出局人信息\n\t\t\t\t\t\tif (msg.Bills.length > 1) {\n\t\t\t\t\t\t\tthis.lastbills = msg.Bills;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 判断是否需要启动计时器，如果只有一个出价，肯定就是需要启动的，因为计时器未启动\n\t\t\t\t\t\tif (msg.Bills.length === 1) {\n\t\t\t\t\t\t\tthis.timerState();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 9:\n\t\t\t\t\t\t//计算剩余时间，并重置剩余时间\n\t\t\t\t\t\tlet dt = new Date();\n\t\t\t\t\t\tlet dt_time = dt.getTime();\n\t\t\t\t\t\tthis.seqTime.setTime(dt_time + msg.SeqMiniSecounds);\n\t\t\t\t\t\tconsole.log(this.seqTime);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 10:\n\t\t\t\t\t\t// 活动正式开始，但是目前尚未有人出价，所以收到此消息，先停止计时器，并显示为 “等待先手”\n\t\t\t\t\t\tclearInterval(timerState);\n\t\t\t\t\t\tthis.times = \"等待首牌\";\n\t\t\t\t\t\tthis.newprice = \"￥\" + msg.currPrice;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 11:\n\t\t\t\t\t\t// 活动结束通知\n\t\t\t\t\t\tclearInterval(timerState);\n\t\t\t\t\t\tthis.times = \"已成交\";\n\t\t\t\t\t\t// 判断是否当前用户，如果是当前用户，则需要弹出收货地址和订单信息处理界面\n\t\t\t\t\t\tif (this.UserID === msg.WinsBill.UserID) {\n\t\t\t\t\t\t\tshowModal(\"恭喜，您已中拍！点击确定去填写订单信息吧！\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconsole.log(msgType);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(\"处理消息出错：\");\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t},\n\t\tasync billTap(type: any) {\n\t\t\tlet action = type;\n\t\t\tlet ActiveID = this.ActiveID;\n\t\t\tlet num = this.num\n\t\t\tlet Price = this.Price;\n\t\t\tlet GUID: any = await this.GUID();\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tswitch (action) {\n\t\t\t\tcase \"报名\":\n\t\t\t\t\tvar SignupMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tShares: num,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 1,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(SignupMsg);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"举牌\":\n\t\t\t\t\tvar billMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tPrice: Price,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 2,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(billMsg);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"托管\":\n\t\t\t\t\tvar tapMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 4,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(tapMsg);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"取消托管\":\n\t\t\t\t\tvar cancelTapMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 5,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(cancelTapMsg);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t// 下面处理倒计时的显示，实际上时间是由服务器webSocket返回的\n\t\tseqDisplay() {\n\t\t\tlet seqTime: any = this.seqTime;\n\t\t\tlet date: any = new Date();\n\t\t\tlet between: number = seqTime - date;\n\t\t\tlet sec: number = Math.floor(between / 1000);\n\t\t\tlet hours: any = Math.floor(Math.floor(sec / 60) / 60) % 24;\n\t\t\tlet minutes: any = Math.floor(sec / 60) % 60;\n\t\t\tlet seconds: any = sec % 60;\n\t\t\tlet minisec: number = Math.floor(between / 100) % 10;\n\t\t\tif (seconds <= 0) {\n\t\t\t\tthis.times = \"\";\n\t\t\t} else {\n\t\t\t\tif (hours < 10) {\n\t\t\t\t\thours = \"0\" + hours;\n\t\t\t\t}\n\t\t\t\tif (minutes < 10) {\n\t\t\t\t\tminutes = \"0\" + minutes;\n\t\t\t\t}\n\t\t\t\tif (seconds < 10) {\n\t\t\t\t\tseconds = \"0\" + seconds;\n\t\t\t\t}\n\t\t\t\tlet times = hours + \":\" + minutes + \":\" + seconds + \".\" + minisec;\n\t\t\t\tthis.times = times;\n\t\t\t}\n\t\t},\n\t\t// 倒计时\n\t\ttimerState() {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tlet timerState = setInterval(() => {\n\t\t\t\t\tthis.seqDisplay();\n\t\t\t\t}, 100);\n\t\t\t\tsesolve(timerState);\n\t\t\t});\n\t\t},\n\t\t// 下面是生成随机GUID的函数\n\t\tGUID() {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tlet guid = \"\";\n\t\t\t\tfor (let i = 1; i <= 32; i++) {\n\t\t\t\t\tlet n = Math.floor(Math.random() * 16.0).toString(16);\n\t\t\t\t\tguid += n;\n\t\t\t\t\tif (i == 8 || i == 12 || i == 16 || i == 20) guid += \"-\";\n\t\t\t\t}\n\t\t\t\tsesolve(guid);\n\t\t\t});\n\t\t}\n\t}\n});\n",{"version":3,"sources":["productDetailsPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"productDetailsPage.vue","sourceRoot":"src/pages/mall/productDetailsPage","sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 轮播 -->\n\t\t<view class=\"i-padding-wrap\">\n\t\t\t<view class=\"page-section swiper\">\n\t\t\t\t<view class=\"page-section-spacing\">\n\t\t\t\t\t<swiper\n\t\t\t\t\t\tclass=\"swiper-box\"\n\t\t\t\t\t\t:indicator-dots=\"indicatorDots\"\n\t\t\t\t\t\t:autoplay=\"autoplay\"\n\t\t\t\t\t\t:interval=\"interval\"\n\t\t\t\t\t\t:duration=\"duration\"\n\t\t\t\t\t\t:circular=\"circular\"\n\t\t\t\t\t\t:indicator-active-color=\"indicatorActiveColor\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<swiper-item v-for=\"(item, index) in swiper\" :key=\"index\">\n\t\t\t\t\t\t\t<image :src=\"item\" mode=\"aspectFill\" />\n\t\t\t\t\t\t</swiper-item>\n\t\t\t\t\t</swiper>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<!-- 标签 -->\n\t\t<view class=\"i-label\">\n\t\t\t<view class=\"i-label-item\" v-for=\"(item, index) in label\" :key=\"index\">\n\t\t\t\t<view class=\"i-point\"></view>\n\t\t\t\t<view class=\"i-label-item-text\">{{item}}</view>\n\t\t\t\t<view class=\"i-point\"></view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"i-product-head\">\n\t\t\t<view class=\"i-product-title\">{{product.ProductTitle}}</view>\n\t\t\t<view class=\"i-product-name\">{{product.ProductName}}</view>\n\t\t</view>\n\t\t<block v-if=\"msgType === 2\">\n\t\t\t<view class=\"i-product-last-transaction\">\n\t\t\t\t<view class=\"i-product-status\">手动举牌</view>\n\t\t\t\t<view class=\"i-product-last-transaction-content\">\n\t\t\t\t\t<view class=\"i-product-last-transaction-text\">上期成交：</view>\n\t\t\t\t\t<view class=\"i-product-last-transaction-price\">¥0.86</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</block>\n\t\t<view class=\"i-product-distance-shooting\">\n\t\t\t<view class=\"i-product-distance-shooting-text\">距离开拍</view>\n\t\t\t<view class=\"i-product-line\"></view>\n\t\t\t<view class=\"i-product-distance-shooting-time\">{{times}}</view>\n\t\t</view>\n\t\t<view class=\"i-product-distance-shooting\">\n\t\t\t<view class=\"i-product-distance-shooting-time\">{{times}}</view>\n\t\t</view>\n\t\t<view class=\"i-product-distance-shooting-end\">\n\t\t\t<view class=\"i-product-distance-shooting-time-end\">竞拍结束</view>\n\t\t</view>\n\t\t<view class=\"i-product-distance-shooting\">\n\t\t\t<view class=\"i-product-distance-shooting-text\">\n\t\t\t\t<text>我已消耗</text>\n\t\t\t\t<text>5</text>\n\t\t\t\t<text>拍币/赠币</text>\n\t\t\t</view>\n\t\t\t<view class=\"i-product-line\"></view>\n\t\t\t<view class=\"i-product-distance-shooting-time\">{{times}}</view>\n\t\t</view>\n\t\t<view class=\"i-product-current-bid\">\n\t\t\t<view class=\"i-product-current-bid-head\">当前出价</view>\n\t\t\t<view class=\"i-product-current-bid-price\">¥0.86</view>\n\t\t\t<view class=\"i-product-current-bid-icon\">\n\t\t\t\t<img :src=\"leading\" />\n\t\t\t\t<text>当前领选出价人</text>\n\t\t\t</view>\n\t\t\t<view class=\"i-product-current-bid-user\">\n\t\t\t\t<img :src=\"src\" />\n\t\t\t\t<view class=\"i-product-current-bid-name\">领选出价人</view>\n\t\t\t\t<view class=\"i-product-current-bid-address\">广东 深圳</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"i-product-bill\">\n\t\t\t<view\n\t\t\t\tclass=\"i-bill\"\n\t\t\t\t:class=\"(item.IsWin === 0?'':'i-active')\"\n\t\t\t\tv-for=\"(item, index) in lastbills\"\n\t\t\t\t:key=\"index\"\n\t\t\t>\n\t\t\t\t<view class=\"i-bill-image i-flex\">\n\t\t\t\t\t<image :src=\"item.UserNick\" />\n\t\t\t\t\t<view class=\"i-bill-user\">{{item.UserMobile}}</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"i-bill-IsWin i-bill-out\" v-if=\"item.IsWin === 0\">出局</view>\n\t\t\t\t<view class=\"i-bill-IsWin i-bill-pre\" v-else>预选</view>\n\t\t\t\t<view class=\"i-bill-province\">{{item.Province}}{{item.City}}</view>\n\t\t\t\t<view class=\"i-bill-price\">{{item.Price}}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"i-product-all-bill uni-list-cell-navigate uni-navigate-right\" @click=\"activePath\">\n\t\t\t<view class=\"i-product-all-bill-text\">\n\t\t\t\t<view class=\"i-product-all-bill-records\">全部出价记录</view>\n\t\t\t\t<view class=\"i-product-all-bill-length\">\n\t\t\t\t\t<text class=\"i-product-all-bill-text-item\">12345</text>\n\t\t\t\t\t<text class=\"i-product-all-bill-text-total\">条</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"i-product-all-bill uni-list-cell-navigate uni-navigate-right\" @click=\"activePath\">\n\t\t\t<view class=\"i-product-all-bill-text\">\n\t\t\t\t<view class=\"i-product-all-bill-records\">我的出价记录</view>\n\t\t\t\t<view class=\"i-product-all-bill-length\">\n\t\t\t\t\t<text class=\"i-product-all-bill-text-item\">8</text>\n\t\t\t\t\t<text class=\"i-product-all-bill-text-total\">条</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"i-product-table\">\n\t\t\t<view class=\"i-product-table-tr\">\n\t\t\t\t<view class=\"i-product-table-td\">\n\t\t\t\t\t<view class=\"i-product-table-content\">\n\t\t\t\t\t\t<img :src=\"src\" />\n\t\t\t\t\t\t<view class=\"i-product-table-text\">\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content\">起拍价</text>\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content-item\">¥0.00</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"i-product-table-td\">\n\t\t\t\t\t<view class=\"i-product-table-content\">\n\t\t\t\t\t\t<img :src=\"src\" />\n\t\t\t\t\t\t<view class=\"i-product-table-text\">\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content\">加价幅度</text>\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content-item\">¥0.01</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"i-product-table-tr\">\n\t\t\t\t<view class=\"i-product-table-td\">\n\t\t\t\t\t<view class=\"i-product-table-content\">\n\t\t\t\t\t\t<img :src=\"src\" />\n\t\t\t\t\t\t<view class=\"i-product-table-text\">\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content\">举牌次数</text>\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content-item\">5次/份</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"i-product-table-td\">\n\t\t\t\t\t<view class=\"i-product-table-content\">\n\t\t\t\t\t\t<img :src=\"src\" />\n\t\t\t\t\t\t<view class=\"i-product-table-text\">\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content\">落拍倒计时</text>\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content-item\">10s</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"i-product-table-tr\">\n\t\t\t\t<view class=\"i-product-table-td\">\n\t\t\t\t\t<view class=\"i-product-table-content\">\n\t\t\t\t\t\t<img :src=\"src\" />\n\t\t\t\t\t\t<view class=\"i-product-table-text\">\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content\">可买份数</text>\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content-item\">5份</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"i-product-table-td\">\n\t\t\t\t\t<view class=\"i-product-table-content\">\n\t\t\t\t\t\t<img :src=\"src\" />\n\t\t\t\t\t\t<view class=\"i-product-table-text\">\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content\">所需费用</text>\n\t\t\t\t\t\t\t<text class=\"i-product-table-text-content-item\">3张</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view\n\t\t\tclass=\"i-product-details uni-list-cell-navigate uni-navigate-right\"\n\t\t\t@click=\"productDetailsUparsePath\"\n\t\t>\n\t\t\t<view class=\"i-product-details-text\">商品详情</view>\n\t\t</view>\n\t\t<view class=\"i-product-tab-content\">\n\t\t\t<view class=\"i-product-tab\">\n\t\t\t\t<view class=\"i-product-tab-item\">\n\t\t\t\t\t<view\n\t\t\t\t\t\tclass=\"i-product-tab-item-tab\"\n\t\t\t\t\t\t:class=\"(tabIndex === index?'i-active':'')\"\n\t\t\t\t\t\tv-for=\"(item, index) in tab\"\n\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t@click=\"tabClick(index)\"\n\t\t\t\t\t>{{item}}</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"i-product-tab-line\"></view>\n\t\t\t</view>\n\t\t\t<view class=\"components\">\n\t\t\t\t<block v-if=\"tabIndex === 0\">\n\t\t\t\t\t<i-past :options=\"pastList\" />\n\t\t\t\t</block>\n\t\t\t\t<block v-else-if=\"tabIndex === 1\">\n\t\t\t\t\t<i-show :options=\"showList\" />\n\t\t\t\t</block>\n\t\t\t\t<block v-else>\n\t\t\t\t\t<i-rule :options=\"ruleList\" />\n\t\t\t\t</block>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"kong\"></view>\n\t\t<view class=\"i-product-join\">\n\t\t\t<button class=\"btn join-btn\" v-show=\"!show\" @click=\"hidePopup\">立即参与</button>\n\t\t\t<button class=\"btn join-btn\" @click=\"hidePopup\">参与下一期</button>\n\t\t\t<block>\n\t\t\t\t<i-popup :show=\"show\" :num=\"num\" @change=\"change\" @click=\"billTap('报名')\" />\n\t\t\t</block>\n\t\t\t<view class=\"i-product-placad\">\n\t\t\t\t<view class=\"i-placard-remaining-num\">\n\t\t\t\t\t<view class=\"i-placard-remaining\">剩余次数：</view>\n\t\t\t\t\t<view class=\"i-placard-num\">{{num}}</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"i-placard-button-view\">\n\t\t\t\t\t<view class=\"i-placard-button\">\n\t\t\t\t\t\t<button class=\"btn\" :disabled=\"disabled\" @click=\"billTap('举牌')\">举牌</button>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"i-placard-button i-placard-active\">\n\t\t\t\t\t\t<button class=\"btn\" :disabled=\"disabled\" @click=\"billTap('托管')\">托管</button>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"ts\">\nimport Vue from \"vue\";\nimport {\n\trequest,\n\tnavigateTo,\n\tformatTime,\n\tshowToast,\n\tshowModal\n} from \"@/common/utils/util\";\nimport {\n\tProductGet,\n\tPastTransactionsListGet,\n\tOrderDryingListGet\n} from \"@/common/config/api\";\nimport iPast from \"@/components/i-past/i-past.vue\";\nimport iShow from \"@/components/i-show/i-show.vue\";\nimport iRule from \"@/components/i-rule/i-rule.vue\";\nimport iPopup from \"@/components/i-popup/i-popup.vue\";\nlet socketOpen: boolean = false;\nlet socketMsgQueue: any = [];\nexport default Vue.extend({\n\tcomponents: {\n\t\tiPast,\n\t\tiShow,\n\t\tiRule,\n\t\tiPopup\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tindicatorDots: true,\n\t\t\tautoplay: true,\n\t\t\tinterval: 2000,\n\t\t\tduration: 500,\n\t\t\tcircular: true,\n\t\t\tindicatorActiveColor: \"#fe7f00\",\n\t\t\tdisabled: false, // 按钮disabled\n\n\t\t\tswiper: [],\n\t\t\ttitle: \"服务\",\n\t\t\tid: \"\",\n\t\t\tproduct: \"\",\n\t\t\tnum: \"1\", // 剩余次数\n\n\t\t\ttabIndex: 0, // 默认往期成交\n\t\t\tpastList: [], // 往期成交列表\n\t\t\tshowList: [], // 晒单列表\n\t\t\truleList: \"\", // 竞拍规则\n\t\t\tshow: false, // 显示弹窗\n\n\t\t\tlabel: [\"零风险\", \"正品承诺\", \"极速发货\", \"公平公正\"],\n\t\t\ttab: [\"往期成交\", \"分享晒单\", \"竞拍规则\"],\n\t\t\tsrc: \"/static/icon_experience.png\",\n\t\t\tleading: \"/static/icon/icon_leading.png\",\n\n\t\t\tActiveID: \"\",\n\t\t\tPrice: \"\",\n\t\t\tmsgID: \"\",\n\t\t\tmsgType: \"\",\n\n\t\t\tseq: \"\", // 更新我的剩余举牌次数\n\t\t\tMyBills: \"\", // 举牌响应消息（包含我的举牌次数、剩余可用次数）\n\t\t\tUserID: \"\", // 登录成功，提示用户\n\t\t\ttapbtn: \"\", // 托管\n\t\t\tBillStat: \"\", // 总举牌次数\n\t\t\tnewprice: \"\", // 领先价格\n\t\t\tnewbill: \"\", // 领先人\n\t\t\tlastbills: [], // 出局列表\n\t\t\ttimes: \"\", // 倒计时\n\t\t\tseqTime: new Date(\"2019/7/20 10:29:35\")\n\t\t};\n\t},\n\tonLoad(options: any) {\n\t\tthis.id = options.id;\n\t\tthis.ActiveID = options.id;\n\t\tthis.UserID = uni.getStorageSync(\"SessionKey\").ID;\n\t\tthis.getProduct();\n\t\tthis.getPastTransactionsList();\n\t\tthis.getOrderDryingList();\n\t\tthis.websocket();\n\t},\n\tmethods: {\n\t\t// 获取产品详情\n\t\tgetProduct() {\n\t\t\tlet ProductID = this.id;\n\t\t\tlet data = {\n\t\t\t\tProductID: ProductID\n\t\t\t};\n\t\t\trequest(ProductGet, data).then((res: any) => {\n\t\t\t\tconsole.log(\"获取产品详情\", res);\n\t\t\t\tthis.product = res.Product;\n\t\t\t\tthis.swiper = res.Product.ProductPicList;\n\t\t\t\tthis.Price = res.Product.ProductPrice;\n\t\t\t});\n\t\t},\n\t\t// 选项卡\n\t\ttabClick(index: number) {\n\t\t\tthis.tabIndex = index;\n\t\t},\n\t\t// 往期成交列表\n\t\tgetPastTransactionsList() {\n\t\t\tlet ProductID = this.id;\n\t\t\tlet data = {\n\t\t\t\tProductID: ProductID\n\t\t\t};\n\t\t\trequest(PastTransactionsListGet, data).then((res: any) => {\n\t\t\t\tconsole.log(res);\n\t\t\t\tlet pastList = res.OrderList;\n\t\t\t\tpastList.map((item: any) => {\n\t\t\t\t\titem.percentage = (\n\t\t\t\t\t\t(item.OrderMoneys / item.OrderPrimeCost) *\n\t\t\t\t\t\t100\n\t\t\t\t\t).toFixed(2);\n\t\t\t\t});\n\t\t\t\tthis.pastList = pastList;\n\t\t\t});\n\t\t},\n\t\tchange(val: any) {\n\t\t\tconsole.log(val);\n\t\t\tthis.num = val;\n\t\t},\n\t\thidePopup() {\n\t\t\tthis.show = !this.show;\n\n\t\t},\n\t\t// 获取用户晒单列表\n\t\tgetOrderDryingList() {\n\t\t\tlet ProductID = this.id;\n\t\t\tlet data = {\n\t\t\t\tProductID: ProductID\n\t\t\t};\n\t\t\trequest(OrderDryingListGet, data).then((res: any) => {\n\t\t\t\tthis.showList = res.OrderList;\n\t\t\t});\n\t\t},\n\t\tactivePath() {\n\t\t\tlet id = this.id;\n\t\t\tnavigateTo(\"../activeBilList/activeBilList?id=\" + id);\n\t\t},\n\t\tproductDetailsUparsePath() {\n\t\t\tlet id = this.id;\n\t\t\tnavigateTo(\"../productDetailsUparse/productDetailsUparse?id=\" + id);\n\t\t},\n\t\twebsocket() {\n\t\t\tuni.connectSocket({\n\t\t\t\turl: \"wss://websocket.tengpaisc.com:8888/\"\n\t\t\t});\n\t\t\tuni.onSocketOpen((res: any) => {\n\t\t\t\tconsole.log(\"WebSocket连接已打开！\");\n\t\t\t\tsocketOpen = true;\n\t\t\t\tfor (let i = 0; i < socketMsgQueue.length; i++) {\n\t\t\t\t\tthis.sendSocketMessage(socketMsgQueue[i]);\n\t\t\t\t}\n\t\t\t\tsocketMsgQueue = [];\n\t\t\t\tthis.reqLogin();\n\t\t\t\tthis.msgSubscribe();\n\t\t\t});\n\t\t\tuni.onSocketError(res => {\n\t\t\t\tconsole.log(\"WebSocket连接打开失败，请检查！\");\n\t\t\t});\n\t\t\tthis.onSocketMessage();\n\t\t},\n\t\tsendSocketMessage(msg: any) {\n\t\t\tlet data: string = JSON.stringify(msg);\n\t\t\tconsole.log(\"发送数据\", socketOpen, msg);\n\t\t\tif (socketOpen) {\n\t\t\t\tuni.sendSocketMessage({\n\t\t\t\t\tdata: data\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocketMsgQueue.push(msg);\n\t\t\t}\n\t\t},\n\t\tonSocketMessage() {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tuni.onSocketMessage((res: any) => {\n\t\t\t\t\tconsole.log(\"收到服务器内容：\" + res.data);\n\t\t\t\t\tlet msg = JSON.parse(res.data);\n\t\t\t\t\tconsole.log(msg);\n\t\t\t\t\tthis.proccessMsg();\n\t\t\t\t\tsesolve(msg);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t// 向服务器发送登录请求\n\t\tasync reqLogin() {\n\t\t\tlet GUID: any = await this.GUID();\n\t\t\tconst Appkey = \"3957399\";\n\t\t\tconst SessionKey = uni.getStorageSync(\"SessionKey\");\n\t\t\tlet ActiveID = this.ActiveID;\n\t\t\tlet UserID = this.UserID;\n\t\t\tlet ConnectionState = false;\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tconsole.log(GUID);\n\t\t\tlet reqLogin: any = {\n\t\t\t\tActiveID: ActiveID,\n\t\t\t\tAppKey: Appkey,\n\t\t\t\tSessionKey: SessionKey,\n\t\t\t\tmsgID: GUID,\n\t\t\t\tmsgType: 3,\n\t\t\t\tmsgTime: msgTime\n\t\t\t};\n\t\t\tthis.sendSocketMessage(reqLogin);\n\t\t},\n\t\t// 发送对该活动的消息订阅\n\t\tasync msgSubscribe() {\n\t\t\tlet GUID: any = await this.GUID();\n\t\t\tlet ActiveID = this.ActiveID;\n\t\t\tlet url = \"/Actives/\" + ActiveID + \"/\";\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tlet reqSubscribe = {\n\t\t\t\tSubscribe: url,\n\t\t\t\tmsgID: GUID,\n\t\t\t\tmsgType: 0,\n\t\t\t\tmsgTime: msgTime\n\t\t\t};\n\t\t\tthis.sendSocketMessage(reqSubscribe);\n\t\t},\n\t\t// 处理消息的函数，用于解析从服务器webSocket收到的各种消息\n\t\tasync proccessMsg() {\n\t\t\tlet msg: any = await this.onSocketMessage();\n\t\t\tlet timerState: any = await this.timerState();\n\t\t\tlet msgType = msg.msgType;\n\t\t\tthis.msgType = msgType;\n\t\t\ttry {\n\t\t\t\tswitch (msgType) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\t// 订阅响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"订阅失败：\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\t// 报名响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"报名失败：\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 更新我的剩余举牌次数\n\t\t\t\t\t\tthis.seq =\n\t\t\t\t\t\t\t\"剩余举牌次数：\" +\n\t\t\t\t\t\t\tmsg.SeqBills +\n\t\t\t\t\t\t\t\"次，已报名份数：\" +\n\t\t\t\t\t\t\tmsg.Signups +\n\t\t\t\t\t\t\t\"份，还可报名：\" +\n\t\t\t\t\t\t\tmsg.SeqSignups +\n\t\t\t\t\t\t\t\"份\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\t// 举牌响应消息（包含我的举牌次数、剩余可用次数）\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.MyBills =\n\t\t\t\t\t\t\t\t\"我的举牌次数：\" +\n\t\t\t\t\t\t\t\tmsg.MyBills +\n\t\t\t\t\t\t\t\t\"次，剩余可用次数：\" +\n\t\t\t\t\t\t\t\tmsg.SeqBills +\n\t\t\t\t\t\t\t\t\"次\";\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\t// 登录响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"登录失败：\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// 登录成功，提示用户\n\t\t\t\t\t\t\tthis.UserID = msg.UserID;\n\t\t\t\t\t\t\tshowToast(msg.ErrMsg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 4:\n\t\t\t\t\t\t// 托管响应\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"托管失败!\" + msg.ErrMsg);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.tapbtn = \"取消托管\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 5:\n\t\t\t\t\t\t// 取消托管响应消息\n\t\t\t\t\t\tif (msg.IsError) {\n\t\t\t\t\t\t\tshowToast(\"取消托管失败!\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.tapbtn = \"取消托管\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\t// 价格更新通知\n\t\t\t\t\t\tshowToast(\"价格已更新......！\");\n\t\t\t\t\t\t// 更新全部举牌次数、我的举牌次数、和最新价格\n\t\t\t\t\t\tthis.BillStat = \"总举牌次数：\" + msg.AllBills + \"次\";\n\t\t\t\t\t\t// 更新最后出价人信息\n\t\t\t\t\t\tif (msg.Bills.length > 0) {\n\t\t\t\t\t\t\tthis.newprice = \"￥\" + msg.Bills[0].Price;\n\t\t\t\t\t\t\tthis.newbill = \"领先人：\" + msg.Bills[0].City;\n\t\t\t\t\t\t\t// 计算剩余时长\n\t\t\t\t\t\t\tlet dt = new Date();\n\t\t\t\t\t\t\tlet tm = dt.getTime() + msg.SeqMiniSecounds;\n\t\t\t\t\t\t\tthis.seqTime.setTime(tm);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 更新最近出局人信息\n\t\t\t\t\t\tif (msg.Bills.length > 1) {\n\t\t\t\t\t\t\tthis.lastbills = msg.Bills;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 判断是否需要启动计时器，如果只有一个出价，肯定就是需要启动的，因为计时器未启动\n\t\t\t\t\t\tif (msg.Bills.length === 1) {\n\t\t\t\t\t\t\tthis.timerState();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 9:\n\t\t\t\t\t\t//计算剩余时间，并重置剩余时间\n\t\t\t\t\t\tlet dt = new Date();\n\t\t\t\t\t\tlet dt_time = dt.getTime();\n\t\t\t\t\t\tthis.seqTime.setTime(dt_time + msg.SeqMiniSecounds);\n\t\t\t\t\t\tconsole.log(this.seqTime);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 10:\n\t\t\t\t\t\t// 活动正式开始，但是目前尚未有人出价，所以收到此消息，先停止计时器，并显示为 “等待先手”\n\t\t\t\t\t\tclearInterval(timerState);\n\t\t\t\t\t\tthis.times = \"等待首牌\";\n\t\t\t\t\t\tthis.newprice = \"￥\" + msg.currPrice;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 11:\n\t\t\t\t\t\t// 活动结束通知\n\t\t\t\t\t\tclearInterval(timerState);\n\t\t\t\t\t\tthis.times = \"已成交\";\n\t\t\t\t\t\t// 判断是否当前用户，如果是当前用户，则需要弹出收货地址和订单信息处理界面\n\t\t\t\t\t\tif (this.UserID === msg.WinsBill.UserID) {\n\t\t\t\t\t\t\tshowModal(\"恭喜，您已中拍！点击确定去填写订单信息吧！\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconsole.log(msgType);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(\"处理消息出错：\");\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t},\n\t\tasync billTap(type: any) {\n\t\t\tlet action = type;\n\t\t\tlet ActiveID = this.ActiveID;\n\t\t\tlet num = this.num\n\t\t\tlet Price = this.Price;\n\t\t\tlet GUID: any = await this.GUID();\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tswitch (action) {\n\t\t\t\tcase \"报名\":\n\t\t\t\t\tvar SignupMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tShares: num,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 1,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(SignupMsg);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"举牌\":\n\t\t\t\t\tvar billMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tPrice: Price,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 2,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(billMsg);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"托管\":\n\t\t\t\t\tvar tapMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 4,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(tapMsg);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"取消托管\":\n\t\t\t\t\tvar cancelTapMsg = {\n\t\t\t\t\t\tActiveID: ActiveID,\n\t\t\t\t\t\tmsgID: GUID,\n\t\t\t\t\t\tmsgType: 5,\n\t\t\t\t\t\tmsgTime: msgTime\n\t\t\t\t\t};\n\t\t\t\t\tthis.sendSocketMessage(cancelTapMsg);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t// 下面处理倒计时的显示，实际上时间是由服务器webSocket返回的\n\t\tseqDisplay() {\n\t\t\tlet seqTime: any = this.seqTime;\n\t\t\tlet date: any = new Date();\n\t\t\tlet between: number = seqTime - date;\n\t\t\tlet sec: number = Math.floor(between / 1000);\n\t\t\tlet hours: any = Math.floor(Math.floor(sec / 60) / 60) % 24;\n\t\t\tlet minutes: any = Math.floor(sec / 60) % 60;\n\t\t\tlet seconds: any = sec % 60;\n\t\t\tlet minisec: number = Math.floor(between / 100) % 10;\n\t\t\tif (seconds <= 0) {\n\t\t\t\tthis.times = \"\";\n\t\t\t} else {\n\t\t\t\tif (hours < 10) {\n\t\t\t\t\thours = \"0\" + hours;\n\t\t\t\t}\n\t\t\t\tif (minutes < 10) {\n\t\t\t\t\tminutes = \"0\" + minutes;\n\t\t\t\t}\n\t\t\t\tif (seconds < 10) {\n\t\t\t\t\tseconds = \"0\" + seconds;\n\t\t\t\t}\n\t\t\t\tlet times = hours + \":\" + minutes + \":\" + seconds + \".\" + minisec;\n\t\t\t\tthis.times = times;\n\t\t\t}\n\t\t},\n\t\t// 倒计时\n\t\ttimerState() {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tlet timerState = setInterval(() => {\n\t\t\t\t\tthis.seqDisplay();\n\t\t\t\t}, 100);\n\t\t\t\tsesolve(timerState);\n\t\t\t});\n\t\t},\n\t\t// 下面是生成随机GUID的函数\n\t\tGUID() {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tlet guid = \"\";\n\t\t\t\tfor (let i = 1; i <= 32; i++) {\n\t\t\t\t\tlet n = Math.floor(Math.random() * 16.0).toString(16);\n\t\t\t\t\tguid += n;\n\t\t\t\t\tif (i == 8 || i == 12 || i == 16 || i == 20) guid += \"-\";\n\t\t\t\t}\n\t\t\t\tsesolve(guid);\n\t\t\t});\n\t\t}\n\t}\n});\n</script>\n\n<style scoped>\n.kong {\n\theight: 98upx;\n}\n\n.i-label {\n\tdisplay: flex;\n\tjustify-content: space-around;\n\talign-items: center;\n\tcolor: #b25a01;\n\tbackground-color: rgba(254, 127, 0, 0.3);\n\theight: 70upx;\n}\n\n.i-point {\n\twidth: 10upx;\n\theight: 10upx;\n\tbackground-color: rgba(254, 127, 0, 0.2);\n\tborder-radius: 50%;\n}\n\n.i-label-item {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.i-label-item-text {\n\tmargin: 0 10upx;\n}\n\n.i-product-head {\n\tpadding: 20upx 30upx;\n}\n\n.i-product-title {\n\tfont-size: 32upx;\n\tcolor: #4d4d4d;\n\tline-height: 1.2;\n\tfont-weight: 600;\n}\n\n.i-product-current-bid {\n\tmargin: 0 30upx;\n\ttext-align: center;\n}\n\n.i-product-current-bid-head {\n\tfont-size: 30upx;\n\tfont-weight: 500;\n\tcolor: #414141;\n}\n\n.i-product-current-bid-price {\n\tfont-size: 56upx;\n\tfont-weight: 600;\n\tcolor: #414141;\n}\n\n.i-product-current-bid-icon {\n\tposition: relative;\n}\n\n.i-product-current-bid-icon img {\n\twidth: 100%;\n}\n\n.i-product-current-bid-icon text {\n\tposition: absolute;\n\ttop: 18upx;\n\tleft: 0;\n\tright: 0;\n\tfont-size: 36upx;\n\tfont-weight: 600;\n\tcolor: #fffefe;\n}\n\n.i-product-current-bid-user img {\n\twidth: 120upx;\n\theight: 120upx;\n}\n\n.i-product-current-bid-name {\n\tfont-size: 30upx;\n\tfont-weight: 600;\n\tcolor: #fe7f00;\n}\n\n.i-product-current-bid-address {\n\tfont-size: 28upx;\n\tfont-weight: 600;\n\tcolor: #848484;\n}\n\n.i-product-last-transaction {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin: 0 30upx;\n}\n\n.i-product-status {\n\twidth: 140upx;\n\tfont-size: 28upx;\n\ttext-align: center;\n\tcolor: #fe7f00;\n\tborder-radius: 100upx;\n\tborder: 2upx solid #fe7f00;\n}\n\n.i-product-last-transaction-content {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-left: 35upx;\n}\n\n.i-product-last-transaction-text {\n\tfont-size: 28upx;\n\tcolor: #000000;\n}\n\n.i-product-last-transaction-price {\n\tfont-size: 36upx;\n\tcolor: #fe7f00;\n\tfont-weight: 600;\n}\n\n.i-product-distance-shooting {\n\tdisplay: flex;\n\tjustify-content: space-around;\n\talign-items: center;\n\tmargin: 10upx 30upx;\n\tpadding: 0 30upx;\n\tborder: 2upx solid #fe7f00;\n\tborder-radius: 100upx;\n}\n\n.i-product-distance-shooting-text {\n\tfont-size: 30upx;\n\tcolor: #4d4d4d;\n\tpadding: 0 20upx;\n}\n\n.i-product-line {\n\twidth: 2upx;\n\theight: 60upx;\n\tbackground-color: #717171;\n}\n\n.i-product-distance-shooting-time {\n\tfont-size: 58upx;\n\tline-height: 88upx;\n\tfont-weight: 600;\n\tcolor: #fe7f00;\n}\n\n.i-product-distance-shooting-end {\n\ttext-align: center;\n\tmargin: 10upx 30upx;\n\tpadding: 0 30upx;\n\tborder: 2upx solid #717171;\n\tborder-radius: 100upx;\n}\n\n.i-product-distance-shooting-time-end {\n\tfont-size: 58upx;\n\tline-height: 88upx;\n\tfont-weight: 600;\n\tcolor: #010101;\n}\n\n.i-product-table {\n\tdisplay: table;\n\twidth: calc(100% - 60upx);\n\tborder-collapse: collapse;\n\tbox-sizing: border-box;\n\tmargin: 30upx 30upx;\n}\n\n.i-product-table-tr {\n\tdisplay: table-row;\n\theight: 80rpx;\n}\n\n.i-product-table-td {\n\tdisplay: table-cell;\n\tborder: 2upx solid #c9c9c9;\n\tvertical-align: middle;\n\tpadding: 0 30upx;\n}\n\n.i-product-table-text {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-left: 20upx;\n}\n\n.i-product-table img {\n\twidth: 20upx;\n\theight: 20upx;\n}\n\n.i-product-table-content {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.i-product-table-text-content {\n\tfont-size: 32upx;\n\tcolor: #4d4d4d;\n}\n\n.i-product-table-text-content-item {\n\tfont-size: 32upx;\n\tcolor: #4d4d4d;\n\tmargin-left: 20upx;\n}\n\n.i-product-tab {\n\tborder-top: 2upx solid #f4f4f4;\n\tborder-bottom: 2upx solid #f4f4f4;\n}\n\n.i-product-tab-item {\n\tdisplay: flex;\n\tjustify-content: space-around;\n\talign-items: center;\n\theight: 100upx;\n}\n\n.i-active {\n\tcolor: #fe7f00;\n}\n\n.i-product-join {\n\tposition: fixed;\n\tbottom: 0;\n\twidth: 100%;\n\tz-index: 10;\n}\n\n.join-btn {\n\theight: 106upx;\n\tline-height: 106upx;\n\tcolor: #fff;\n\tbackground-color: #fe7c13;\n}\n\n.i-product-placard {\n\tposition: fixed;\n\tbottom: 0;\n\twidth: 100%;\n\theight: 90upx;\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.i-placard-remaining-num {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\twidth: 60%;\n\tbackground-color: #fff;\n}\n\n.i-placard-remaining {\n\tfont-size: 28upx;\n\tcolor: #5c5c5c;\n}\n\n.i-placard-num {\n\tfont-size: 48upx;\n\tcolor: #fe7c13;\n\tfont-weight: 600;\n}\n\n.i-bill {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\theight: 120upx;\n\tfont-size: 32upx;\n\tline-height: 120upx;\n\tborder-bottom: 2upx solid #f4f4f4;\n\tpadding: 0 30upx;\n}\n\n.i-bill-out {\n\tcolor: #30a900;\n}\n\n.i-bill-pre {\n\tcolor: #fe7f00;\n}\n\n.i-active {\n\tcolor: #fe7f00;\n}\n\n.i-bill-image {\n\tmin-width: 260upx;\n}\n\n.i-bill-image image {\n\twidth: 84upx;\n\theight: 84upx;\n}\n\n.i-bill-user {\n\tmargin-left: 20upx;\n}\n\n.i-product-all-bill {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.i-product-all-bill-text {\n\tdisplay: flex;\n\tjustify-content: flex-start;\n\talign-items: center;\n}\n\n.i-product-all-bill-records {\n\tfont-size: 28upx;\n\tcolor: #474747;\n}\n\n.i-product-all-bill-length {\n\tfont-size: 28upx;\n}\n\n.i-product-all-bill-text-item {\n\tcolor: #fe7f00;\n\tmargin-left: 20upx;\n\tmargin-right: 10upx;\n}\n\n.i-product-placad {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.i-placard-button-view {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\talign-items: center;\n}\n\n.i-placard-button {\n\twidth: 200upx;\n\theight: 90upx;\n\tfont-size: 30upx;\n}\n\n.i-placard-button button {\n\tcolor: #fe7c13;\n\tbackground-color: #fff;\n\tborder-left: 2upx solid #f4f4f4;\n}\n\n.i-placard-active button {\n\tcolor: #fff;\n\tbackground-color: #fe7c13;\n\tborder-left: 2upx solid #f4f4f4;\n}\n\n.btn {\n\tborder: none;\n\tborder-radius: 0;\n}\n\n.btn:after {\n\tborder: none;\n\tborder-radius: 0;\n}\n</style>\n"]}]}