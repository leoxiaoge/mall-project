{"remainingRequest":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lee/Desktop/github/mall-project/src/components/robby-image-upload/robby-image-upload.vue?vue&type=style&index=0&id=b83a2ee2&scoped=true&lang=css&","dependencies":[{"path":"/Users/lee/Desktop/github/mall-project/src/components/robby-image-upload/robby-image-upload.vue","mtime":1572115792718},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1563798331564},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/css-loader/index.js","mtime":1554990705185},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1563798333387},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/postcss-loader/src/index.js","mtime":1554990705524},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js","mtime":1563798333387},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":1563798331564}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.imageUploadContainer{\n\tpadding: 10upx 5upx;\n\tmargin: 10upx 5upx;\n}\n\n.dragging{\n\ttransform: scale(1.2)\n}\n\n.imageUploadList{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n}\n\n.imageItem, .imageUpload{\n\twidth: 160upx;\n\theight: 160upx;\n\tmargin: 10upx;\n}\n\n.imageDel{\n\tposition: relative;\n\tleft: 120upx;\n\tbottom: 165upx;\n\tbackground-color: rgba(0,0,0,0.5);\n\twidth: 36upx;\n\ttext-align: center;\n\tline-height: 35upx;\n\tborder-radius: 17upx;\n\tcolor: white;\n\tfont-size: 30upx;\n\tpadding-bottom: 2upx;\n}\n\n.imageItem image, .moveImage{\n\twidth: 160upx;\n\theight: 160upx;\n\tborder-radius: 8upx;\n}\n\n.imageUpload{\n\tline-height: 130upx;\n\ttext-align: center;\n\tfont-size: 150upx;\n\tcolor: #D9D9D9;\n\tborder: 1px solid #D9D9D9;\n\tborder-radius: 8upx;\n}\n\n.upload {\n\tpadding: 20upx 0;\n}\n\n.image-add {\n\twidth: 48upx;\n\theight: 48upx;\n}\n\n.image-upload-text {\n\tfont-size: 24upx;\n\tcolor: #b0b0b0;\n}\n\n.moveImage{\n\tposition: absolute;\n}\n",{"version":3,"sources":["robby-image-upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuQA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"robby-image-upload.vue","sourceRoot":"src/components/robby-image-upload","sourcesContent":["<template>\n\t<view class=\"imageUploadContainer\">\n\t\t<view class=\"imageUploadList\">\n\t\t\t<view class=\"imageItem\" v-bind:key=\"index\" v-for=\"(path,index) in picUrl\">\n\t\t\t\t<image :src=\"url + path\" :class=\"{'dragging':isDragging(index)}\" draggable=\"true\" @tap=\"previewImage\" :data-index=\"index\" @touchstart=\"start\" @touchmove=\"move\" @touchend=\"stop\"></image>\n\t\t\t\t<view v-if=\"isShowDel\" class=\"imageDel\" @tap=\"deleteImage\" :data-index=\"index\">x</view>\n\t\t\t</view>\n\t\t\t<view v-if=\"isShowAdd\" class=\"imageUpload\" @tap=\"selectImage\">\n\t\t\t\t<view class=\"upload\">\n\t\t\t\t\t<img class=\"image-add\" :src=\"imageUpload\" />\n\t\t\t\t\t<view class=\"image-upload-text\">添加图片</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<image v-if=\"showMoveImage\" class=\"moveImage\" :style=\"{left:posMoveImageLeft, top:posMoveImageTop}\" :src=\"moveImagePath\"></image>\n\t</view>\n</template>\n\n<script>\n\tvar _self;\n\timport { upload, navigateTo, showToast } from \"@/common/utils/util\";\n  import { OrderDryingUpload } from \"@/common/config/api\";\n\texport default {\n\t\tname:'robby-image-upload',\n\t\tprops: {\n\t\t  value: {\n\t\t\t\ttype: Array,\n\t\t\t\tdefault () {\n\t\t\t\t\treturn []\n\t\t\t\t}\n\t\t\t},\n\t\t\tenableDel: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true\n\t\t\t},\n\t\t\tenableAdd: {\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault: true\n\t\t\t}\n\t  },\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\timageBasePos:{\n\t\t\t\t\tx0: -1,\n\t\t\t\t\ty0: -1,\n\t\t\t\t\tw:-1,\n\t\t\t\t\th:-1,\n\t\t\t\t},\n\t\t\t\tshowMoveImage: false,\n\t\t\t\tmoveImagePath: '',\n\t\t\t\tmoveLeft: 0,\n\t\t\t\tmoveTop: 0,\n\t\t\t\tdeltaLeft: 0,\n\t\t\t\tdeltaTop: 0,\n\t\t\t\tdragIndex: null,\n\t\t\t\ttargetImageIndex: null,\n\t\t\t\tpicUrl: [],\n\t\t\t\turl: \"https://api.tengpaisc.com\",\n\t\t\t\timageUpload: \"/static/icon/icon_image_upload.png\"\n\t\t\t}\n\t\t},\n\t\tcomputed:{\n\t\t\tposMoveImageLeft: function(){ \n\t\t\t\treturn this.moveLeft + 'px'\n\t\t\t},\n\t\t\tposMoveImageTop: function(){\n\t\t\t\treturn this.moveTop + 'px'\n\t\t\t},\n\t\t\tisShowDel: function(){\n\t\t\t\tif(this.enableDel === false){\n\t\t\t\t\treturn false\n\t\t\t\t}else{\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t},\n\t\t\tisShowAdd: function(){\n\t\t\t\tif(this.enableAdd === false){\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(this.limit && this.value.length >= this.limit){\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn true\n\t\t\t},\n\t\t\tisDragable: function(){\n\t\t\t\tif(this.enableDrag === false){\n\t\t\t\t\treturn false\n\t\t\t\t}else{\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tselectImage: function(){\n\t\t\t\t_self = this\n\t\t\t\tif(!_self.value){\n\t\t\t\t\t_self.value = []\n\t\t\t\t}\n\t\t\t\tuni.chooseImage({\n\t\t\t\t\tcount: _self.limit ? (_self.limit - _self.value.length) : 999,\n\t\t\t\t\tsuccess: (e) => {\n\t\t\t\t\t\tvar imagePathArr = e.tempFilePaths\n\t\t\t\t\t\t//如果设置了limit限制，在web上count参数无效，这里做判断控制选择的数量是否合要求\n\t\t\t\t\t\t//在非微信小程序里，虽然可以选多张，但选择的结果会被截掉\n\t\t\t\t\t\t//在app里，会自动做选择数量的限制\n\t\t\t\t\t\tif(_self.limit){\n\t\t\t\t\t\t\tvar availableImageNumber = _self.limit - _self.value.length\n\t\t\t\t\t\t\tif(availableImageNumber < imagePathArr.length){\n\t\t\t\t\t\t\t\tlet title = `图片总数限制为${_self.limit}张，当前还可以选${availableImageNumber}张`\n\t\t\t\t\t\t\t\tshowToast(title)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.log(imagePathArr)\n\t\t\t\t\t\timagePathArr.forEach((item) => {\n\t\t\t\t\t\t\t_self.uploadImage(item)\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfor(let i=0; i<imagePathArr.length;i++){\n\t\t\t\t\t\t\t_self.value.push(imagePathArr[i])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tuploadImage: function(filePath) {\n\t\t\t\tlet data = {};\n\t\t\t\tupload(OrderDryingUpload, data, filePath).then((res) => {\n\t\t\t\t\tconsole.log(res)\n\t\t\t\t\tlet data = JSON.parse(res)\n\t\t\t\t\tconsole.log(data.PicUrl)\n\t\t\t\t\tconsole.log(_self.picUrl)\n\t\t\t\t\tlet picUrl = data.PicUrl\n\t\t\t\t\tconsole.log(_self.picUrl, picUrl)\n\t\t\t\t\t_self.picUrl = _self.picUrl.concat(data.PicUrl);\n\t\t\t\t\tthis.$emit('add',{\n\t\t\t\t\t\tcurrentImage: picUrl,\n\t\t\t\t\t\tallImages: _self.picUrl\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t},\n\t\t\tdeleteImage: function(e){\n\t\t\t\tvar imageIndex = e.currentTarget.dataset.index\n\t\t\t\tvar deletedImagePath = this.value[imageIndex]\n\t\t\t\tthis.value.splice(imageIndex, 1) \n\t\t\t\tthis.picUrl.splice(imageIndex, 1)\n\t\t\t\tthis.$emit('delete',{\n\t\t\t\t\tcurrentImage: deletedImagePath,\n\t\t\t\t\tallImages: this.picUrl\n\t\t\t\t})\n\t\t\t\tthis.$emit('input', this.value)\n\t\t\t},\n\t\t\tpreviewImage: function(e){\n\t\t\t\tvar imageIndex = e.currentTarget.dataset.index\n\t\t\t\tlet current = this.value[imageIndex]\n\t\t\t\tlet urls = this.value\n\t\t\t\tuni.previewImage({\n\t\t\t\t\tcurrent: current,\n\t\t\t\t\tindicator: \"number\",\n\t\t\t\t\tloop: \"true\",\n\t\t\t\t\turls: urls\n\t\t\t\t})\n\t\t\t},\n\t\t\tinitImageBasePos: function(){\n\t\t\t\tlet paddingRate = 0.024\n\t\t\t\t_self = this\n\t\t\t\t//计算图片基准位置\n\t\t\t\tuni.getSystemInfo({\n\t\t\t\t\tsuccess: function(obj) {\n\t\t\t\t\t\tlet screenWidth = obj.screenWidth\n\t\t\t\t\t\tlet leftPadding = Math.ceil(paddingRate * screenWidth)\n\t\t\t\t\t\tlet imageWidth = Math.ceil((screenWidth - 2*leftPadding)/4)\n\t\t\t\t\t\t\n\t\t\t\t\t\t_self.imageBasePos.x0 = leftPadding\n\t\t\t\t\t\t_self.imageBasePos.w = imageWidth\n\t\t\t\t\t\t_self.imageBasePos.h = imageWidth\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tfindOverlapImage: function(posX, posY){\n\t\t\t\tlet rows = Math.floor((posX-this.imageBasePos.x0)/this.imageBasePos.w)\n\t\t\t\tlet cols = Math.floor((posY-this.imageBasePos.y0)/this.imageBasePos.h)\n\t\t\t\tlet indx = cols*4 + rows\n\t\t\t\treturn indx\n\t\t\t},\n\t\t\tisDragging: function(indx){\n\t\t\t\treturn this.dragIndex === indx\n\t\t\t},\n\t\t\tstart: function(e){\n\t\t\t\tif(!this.isDragable){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.dragIndex = e.currentTarget.dataset.index\n\t\t\t\tthis.moveImagePath = this.value[this.dragIndex]\n\t\t\t\tthis.movePicImagePath = this.picUrl[this.dragIndex]\n\t\t\t\tthis.showMoveImage = true\n\t\t\t\t\n\t\t\t\t//计算纵向图片基准位置\n\t\t\t\tif(this.imageBasePos.y0 === -1){\n\t\t\t\t\tthis.initImageBasePos()\n\t\t\t\t\t\n\t\t\t\t\tlet basePosY = Math.floor(this.dragIndex / 4) * this.imageBasePos.h\n\t\t\t\t\tlet currentImageOffsetTop = e.currentTarget.offsetTop\n\t\t\t\t\tthis.imageBasePos.y0 = currentImageOffsetTop - basePosY\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//设置选中图片当前左上角的坐标\n\t\t\t\tthis.moveLeft = e.target.offsetLeft\n\t\t\t\tthis.moveTop = e.target.offsetTop\n\t\t\t},\n\t\t\tmove: function(e){\n\t\t\t\tif(!this.isDragable){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst touch = e.touches[0]\n\t\t\t\tthis.targetImageIndex = this.findOverlapImage(touch.clientX, touch.clientY)\n\t\t\t\t\n\t\t\t\t//初始化deltaLeft/deltaTop\n\t\t\t\tif(this.deltaLeft === 0){\n\t\t\t\t\tthis.deltaLeft = touch.clientX - this.moveLeft\n\t\t\t\t\tthis.deltaTop = touch.clientY - this.moveTop \n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//设置移动图片位置\n\t\t\t\tthis.moveLeft = touch.clientX - this.deltaLeft\n\t\t\t\tthis.moveTop = touch.clientY - this.deltaTop\n\t\t\t},\n\t\t\tstop: function(e){\n\t\t\t\tif(!this.isDragable){\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif(this.dragIndex !== null && this.targetImageIndex !== null){\n\t\t\t\t\tif(this.targetImageIndex<0){\n\t\t\t\t\t\tthis.targetImageIndex = 0\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tif(this.targetImageIndex>=this.value.length){\n\t\t\t\t\t\tthis.targetImageIndex = this.value.length-1\n\t\t\t\t\t}\n\t\t\t\t\t//交换图片\n\t\t\t\t\tif(this.dragIndex !== this.targetImageIndex){\n\t\t\t\t\t\tthis.value[this.dragIndex] = this.value[this.targetImageIndex]\n\t\t\t\t\t\tthis.value[this.targetImageIndex] = this.moveImagePath\n\t\t\t\t\t\tthis.picUrl[this.dragIndex] = this.picUrl[this.targetImageIndex]\n\t\t\t\t\t\tthis.picUrl[this.targetImageIndex] = this.movePicImagePath\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.dragIndex = null\n\t\t\t\tthis.targetImageIndex = null\n\t\t\t\tthis.deltaLeft = 0\n\t\t\t\tthis.deltaTop = 0\n\t\t\t\tthis.showMoveImage = false\n\t\t\t\tconsole.log(this.value)\n\t\t\t\tconsole.log(this.picUrl)\n\t\t\t\tthis.$emit('input', this.value)\n\t\t\t\tthis.$emit('picUrlInput', this.picUrl)\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.imageUploadContainer{\n\t\tpadding: 10upx 5upx;\n\t\tmargin: 10upx 5upx;\n\t}\n\t\n\t.dragging{\n\t\ttransform: scale(1.2)\n\t}\n\t\n\t.imageUploadList{\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t}\n\t\n\t.imageItem, .imageUpload{\n\t\twidth: 160upx;\n\t\theight: 160upx;\n\t\tmargin: 10upx;\n\t}\n\t\n\t.imageDel{\n\t\tposition: relative;\n\t\tleft: 120upx;\n\t\tbottom: 165upx;\n\t\tbackground-color: rgba(0,0,0,0.5);\n\t\twidth: 36upx;\n\t\ttext-align: center;\n\t\tline-height: 35upx;\n\t\tborder-radius: 17upx;\n\t\tcolor: white;\n\t\tfont-size: 30upx;\n\t\tpadding-bottom: 2upx;\n\t}\n\t\n\t.imageItem image, .moveImage{\n\t\twidth: 160upx;\n\t\theight: 160upx;\n\t\tborder-radius: 8upx;\n\t}\n\t\n\t.imageUpload{\n\t\tline-height: 130upx;\n\t\ttext-align: center;\n\t\tfont-size: 150upx;\n\t\tcolor: #D9D9D9;\n\t\tborder: 1px solid #D9D9D9;\n\t\tborder-radius: 8upx;\n\t}\n\t\n\t.upload {\n\t\tpadding: 20upx 0;\n\t}\n\n\t.image-add {\n\t\twidth: 48upx;\n\t\theight: 48upx;\n\t}\n\n\t.image-upload-text {\n\t\tfont-size: 24upx;\n\t\tcolor: #b0b0b0;\n\t}\n\n\t.moveImage{\n\t\tposition: absolute;\n\t}\n</style>"]}]}