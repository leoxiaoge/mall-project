{"remainingRequest":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lee/Desktop/github/mall-project/src/pages/mall/search/search.vue?vue&type=style&index=0&id=a172c916&scoped=true&lang=css&","dependencies":[{"path":"/Users/lee/Desktop/github/mall-project/src/pages/mall/search/search.vue","mtime":1569678957853},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":1563798331564},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/css-loader/index.js","mtime":1554990705185},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1563798333387},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/postcss-loader/src/index.js","mtime":1554990705524},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/postcss-loader/src/index.js","mtime":1554990705524},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/cache-loader/dist/cjs.js","mtime":1554990705312},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/vue-loader/lib/index.js","mtime":1563798333387},{"path":"/Users/lee/Desktop/github/mall-project/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":1563798331564}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npage {\n\tbackground-color: #fff;\n}\n.search {\n\tmargin: 20upx 20upx 0 20upx;\n}\n",{"version":3,"sources":["search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmOA;AACA;AACA;AACA;AACA;AACA","file":"search.vue","sourceRoot":"src/pages/mall/search","sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"search\">\n\t\t\t<i-search\n\t\t\t\t:iconSrc=\"iconSrc\"\n\t\t\t\t:focus=\"focus\"\n\t\t\t\t@blur=\"blur\"\n\t\t\t\t@search=\"search\"\n\t\t\t\t@manager=\"manager\"\n\t\t\t\t@scan=\"scan\"\n\t\t\t></i-search>\n\t\t</view>\n\t\t<view class=\"product-list\">\n\t\t\t<product-list :options=\"productList\" />\n\t\t</view>\n\t\t<view class=\"no\" v-if=\"noShow\">\n\t\t\t<i-no :thumb=\"thumb\" :title=\"title\"></i-no>\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"ts\">\nimport Vue from \"vue\";\nimport {\n\trequest,\n\tnavigateTo,\n\tshowToast,\n\tshowErrorToast,\n\tformatTime,\n\tonShareAppMessage\n} from \"@/common/utils/util\";\nimport { ProductSearchListGet } from \"@/common/config/api\";\nimport iSearch from \"@/components/i-search/i-search.vue\";\nimport iNo from \"@/components/u-no/u-no.vue\";\nimport productList from \"@/components/product-search-list/product-search-list.vue\";\nlet socketOpen: boolean = false;\nlet socketMsgQueue: any = [];\nexport default Vue.extend({\n\tcomponents: {\n\t\tiSearch,\n\t\tiNo,\n\t\tproductList\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tpageNum: 1,\n\t\t\tpageSize: 10,\n\t\t\tkeyword: \"\",\n\t\t\tpageCount: 1,\n\t\t\tproductList: [],\n\t\t\tfocus: false,\n\t\t\tnoShow: false,\n\t\t\tisReseMode: false,\n\t\t\tthumb: \"http://www.mescroll.com/img/mescroll-empty.png?v=1\",\n\t\t\ttitle: \"暂无搜索数据\",\n\t\t\ticonSrc: {\n\t\t\t\tlogo: \"/static/icon/icon_search.png\",\n\t\t\t\tvoice: \"/static/img/icon_voice.png\",\n\t\t\t\tscan: \"/static/img/icon_scan.png\",\n\t\t\t\tclear: \"/static/img/icon_clear.png\"\n\t\t\t}\n\t\t};\n\t},\n\tonLoad(options) {\n\t\tconsole.log(\"onLoad\", options);\n\t},\n\tonShow() {\n\t\tthis.websocket();\n\t},\n\tonHide() {\n\t\tuni.closeSocket();\n\t},\n\tonUnload() {\n\t\tuni.closeSocket();\n\t},\n\tonReachBottom() {\n\t\tif (this.pageNum < this.pageCount) {\n\t\t\tthis.pageNum++;\n\t\t\tthis.getListDataFromNet();\n\t\t}\n\t},\n\tonShareAppMessage(e: any) {\n\t\treturn onShareAppMessage(e);\n\t},\n\tmethods: {\n\t\twebsocket() {\n\t\t\tuni.connectSocket({\n\t\t\t\turl: \"wss://websocket.tengpaisc.com\"\n\t\t\t});\n\t\t\tuni.onSocketOpen((res: any) => {\n\t\t\t\tconsole.log(\"WebSocket连接已打开！\");\n\t\t\t\tuni.hideLoading();\n\t\t\t\tsocketOpen = true;\n\t\t\t\tfor (let i = 0; i < socketMsgQueue.length; i++) {\n\t\t\t\t\tthis.sendSocketMessage(socketMsgQueue[i]);\n\t\t\t\t}\n\t\t\t\tsocketMsgQueue = [];\n\t\t\t\tthis.onSocketMessage();\n\t\t\t});\n\t\t\tuni.onSocketError(res => {\n\t\t\t\tconsole.log(\"WebSocket连接打开失败，请检查！\");\n\t\t\t\t// 断线调用函数\n\t\t\t\tshowErrorToast(\"断线重连中...\");\n\t\t\t\tthis.websocket();\n\t\t\t});\n\t\t},\n\t\tsendSocketMessage(msg: any) {\n\t\t\tlet data: string = JSON.stringify(msg);\n\t\t\tconsole.log(\"发送数据\", socketOpen, msg);\n\t\t\tif (socketOpen) {\n\t\t\t\tuni.sendSocketMessage({\n\t\t\t\t\tdata: data\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocketMsgQueue.push(msg);\n\t\t\t}\n\t\t},\n\t\tonSocketMessage() {\n\t\t\tuni.onSocketMessage((res: any) => {\n\t\t\t\tlet msg: any = JSON.parse(res.data);\n\t\t\t\tconsole.log(\"收到服务器内容：\" + res.data);\n\t\t\t\tlet msgType = msg.msgType;\n\t\t\t\tif (msg == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tswitch (msgType) {\n\t\t\t\t\t\tcase 21:\n\t\t\t\t\t\t\tthis.productList.map((item: any) => {\n\t\t\t\t\t\t\t\tif (msg.ActiveID === item.Active.ID) {\n\t\t\t\t\t\t\t\t\tif (msg.LastBill) {\n\t\t\t\t\t\t\t\t\t\titem.Active.LastBillUserName = decodeURIComponent(\n\t\t\t\t\t\t\t\t\t\t\tmsg.LastBill.nick\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\titem.Active.LastBillUserFace = msg.LastBill.face;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\titem.Price = msg.Price;\n\t\t\t\t\t\t\t\t\titem.Active.SeqMiniSeconds = msg.SeqMiniSeconds;\n\t\t\t\t\t\t\t\t\titem.Status = msg.Status;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tlet productLists = JSON.parse(JSON.stringify(this.productList));\n\t\t\t\t\t\t\tthis.productList = productLists;\n\t\t\t\t\t\t\tconsole.log(this.productList);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(\"处理消息出错：\" + e);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t// 发送对该活动的消息订阅\n\t\tmsgSubscribe(e: any) {\n\t\t\tconsole.log(\"发送对该活动的消息订阅\");\n\t\t\tlet Activeids = e;\n\t\t\tlet msgTime = formatTime(new Date());\n\t\t\tlet isReseMode = this.isReseMode;\n\t\t\tlet reqSubscribe = {\n\t\t\t\tmsgType: 20,\n\t\t\t\tmsgTime: msgTime,\n\t\t\t\tisReseMode: isReseMode,\n\t\t\t\tActiveids: Activeids\n\t\t\t};\n\t\t\tthis.sendSocketMessage(reqSubscribe);\n\t\t},\n\t\tblur(e: any) {\n\t\t\tthis.keyword = e;\n\t\t\tthis.pageNum = 1;\n\t\t\tthis.getListDataFromNet();\n\t\t},\n\t\tsearch(e: any) {\n\t\t\tthis.keyword = e;\n\t\t\tthis.pageNum = 1;\n\t\t\tthis.getListDataFromNet();\n\t\t},\n\t\tmanager(e: any) {\n\t\t\tthis.keyword = e;\n\t\t\tthis.pageNum = 1;\n\t\t\tthis.getListDataFromNet();\n\t\t},\n\t\tscan(e: any) {\n\t\t\tthis.keyword = e.result;\n\t\t\tthis.pageNum = 1;\n\t\t\tthis.getListDataFromNet();\n\t\t},\n\t\tasync getListDataFromNet() {\n\t\t\tlet pageNum = this.pageNum;\n\t\t\tlet pageSize = this.pageSize;\n\t\t\tlet productList: any = await this.getProductSearchList(pageNum, pageSize);\n\t\t\tlet data: any = productList.map((item: any) => item.Active.ID);\n\t\t\tthis.msgSubscribe(data);\n\t\t\tif (this.pageNum == 1) this.productList = [];\n\t\t\tthis.productList = this.productList.concat(productList);\n\t\t\tif (this.productList.length <= 0) {\n\t\t\t\tthis.noShow = true;\n\t\t\t} else {\n\t\t\t\tthis.noShow = false;\n\t\t\t}\n\t\t},\n\t\tgetProductSearchList(pageNum: number, pageSize: number) {\n\t\t\treturn new Promise((sesolve, reject) => {\n\t\t\t\tlet Keyword = this.keyword;\n\t\t\t\tif (!Keyword) {\n\t\t\t\t\tshowToast(\"请输入搜索词！\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet data = {\n\t\t\t\t\tPageID: pageNum,\n\t\t\t\t\tPageSize: pageSize,\n\t\t\t\t\tKeyword: Keyword\n\t\t\t\t};\n\t\t\t\trequest(ProductSearchListGet, data)\n\t\t\t\t\t.then((res: any) => {\n\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\tthis.pageCount = res.PageCount;\n\t\t\t\t\t\tsesolve(res.ProductList);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err: any) => {\n\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n});\n</script>\n\n<style scoped>\npage {\n\tbackground-color: #fff;\n}\n.search {\n\tmargin: 20upx 20upx 0 20upx;\n}\n</style>\n"]}]}