const loaderUtils = require('loader-utils')

const {
    normalizePath
} = require('@dcloudio/uni-cli-shared')


module.exports = function(content) {
    this.cacheable && this.cacheable()

    if (this.resourceQuery) {
        const params = loaderUtils.parseQuery(this.resourceQuery)
        if (params && params.page) {
            params.page = decodeURIComponent(params.page)
            // import Vue from 'vue'是为了触发 vendor 合并
            return `
import App from './${normalizePath(params.page)}.nvue?mpType=page'
App.mpType='page'
App.el = '#root'
new Vue(App)
`
        }
    }
    return content
}
