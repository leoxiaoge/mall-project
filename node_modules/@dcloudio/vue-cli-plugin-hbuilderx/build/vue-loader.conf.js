const TAGS = [
  'text',
  'image',
  'input',
  'textarea',
  'web-view'
]
const modules = []

const deprecated = {
  events: {
    'tap': 'click'
  }
}

if (process.env.UNI_USING_NVUE_COMPILER) {
  modules.push({
    postTransformNode (el) {
      if (TAGS.includes(el.tag)) {
        el.tag = 'u-' + el.tag
      }
      if (el.events) {
        const {
          events: eventsMap
        } = deprecated
        Object.keys(el.events).forEach(name => {
          // 过时事件类型转换
          if (eventsMap[name]) {
            el.events[eventsMap[name]] = el.events[name]
            delete el.events[name]
            name = eventsMap[name]
          }
        })
      }
    }
  })
}

module.exports = {
  preserveWhitespace: false,
  compiler: require('weex-template-compiler'),
  compilerOptions: {
    modules
  }
}
